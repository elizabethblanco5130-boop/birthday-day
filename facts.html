<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0" />
  <title>FACTS — ARCADE QUEST</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink: rgba(255, 0, 153, .75);
      --cyan: rgba(0, 255, 255, .35);
      --red: rgba(255,0,0,.55);
      --glass: rgba(0,0,0,.55);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --panel: rgba(0,0,0,.42);
      --line: rgba(255,255,255,.10);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:#000;
      color:#fff;
      overflow:hidden;
      font-family: system-ui, -apple-system, Arial;
      touch-action: manipulation;
    }

    /* ===== BACKGROUND (you can change later) ===== */
    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,0,153,.14), rgba(0,0,0,.88)),
        radial-gradient(circle at 80% 70%, rgba(0,255,255,.10), rgba(0,0,0,.92));
      z-index:0;
    }

    /* CRT overlay */
    .crt{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:5;
      background:
        linear-gradient(to bottom, rgba(255,255,255,.04), rgba(255,255,255,0) 18%, rgba(0,0,0,.08)),
        repeating-linear-gradient(to bottom, rgba(255,255,255,.03) 0px, rgba(255,255,255,.03) 1px, rgba(0,0,0,0) 3px, rgba(0,0,0,0) 5px);
      mix-blend-mode: screen;
      opacity:.35;
    }
    .vignette{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:6;
      background: radial-gradient(ellipse at center, rgba(0,0,0,.06), rgba(0,0,0,.86));
    }

    /* top bar */
    .top{
      position:fixed; left:14px; right:14px; top:14px;
      display:flex; gap:10px;
      align-items:center; justify-content:space-between;
      z-index:50;
      flex-wrap:wrap;
    }
    .chip, .btn{
      border-radius:14px;
      border:1px solid rgba(255,0,153,.45);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 20px rgba(255,0,153,.10);
      color: var(--txt);
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      padding:12px 14px;
      user-select:none;
    }
    .btn{ cursor:pointer; }
    .btn:active{ transform: translateY(1px); }
    a.btn{ text-decoration:none; display:inline-flex; align-items:center; justify-content:center; }

    .title{
      flex:1;
      min-width: 260px;
      text-align:center;
      border-color: rgba(255,255,255,.10);
      box-shadow: 0 0 20px rgba(0,255,255,.08);
      letter-spacing:.10em;
    }

    /* main stage */
    .stage{
      position:fixed; inset:0;
      padding:78px 14px 98px;
      z-index:20;
      display:grid;
      place-items:center;
    }

    .cabinet{
      width:min(1100px, 96vw);
      height:min(76vh, 720px);
      border-radius:26px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.32));
      backdrop-filter: blur(10px);
      box-shadow:
        0 0 0 2px rgba(255,0,153,.08),
        0 0 36px rgba(255,0,153,.12),
        0 0 30px rgba(0,255,255,.08);
      overflow:hidden;
      position:relative;
    }

    /* neon header inside cabinet */
    .cabHeader{
      padding:14px 14px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      background: rgba(0,0,0,.22);
    }
    .cabHeader .big{
      font-size:14px;
      letter-spacing:.10em;
      text-shadow: 0 0 18px rgba(255,0,153,.18), 2px 0 rgba(0,255,255,.10), -2px 0 rgba(255,0,0,.10);
    }
    .statline{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      color: var(--muted);
    }
    .pill{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
    }

    /* battle grid */
    .battle{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      padding:14px;
      height: calc(100% - 64px);
    }

    .panel{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
      box-shadow: inset 0 0 0 1px rgba(255,0,153,.08);
      overflow:hidden;
      position:relative;
      min-height: 280px;
    }

    /* hero / enemy presentation */
    .who{
      display:flex;
      gap:12px;
      padding:14px;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.20);
    }
    .avatar{
      width:96px; height:96px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      background: rgba(0,0,0,.35);
      box-shadow: 0 0 18px rgba(255,0,153,.10);
      flex:0 0 auto;
    }
    .avatar img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .meta{
      flex:1;
      min-width: 0;
    }
    .name{
      font-family:'Press Start 2P', monospace;
      font-size:11px;
      letter-spacing:.06em;
      text-transform: uppercase;
      color: var(--txt);
      line-height:1.35;
    }
    .sub{
      margin-top:8px;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      color: rgba(255,255,255,.72);
      line-height:1.6;
    }

    .log{
      padding:14px;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.05em;
      line-height:1.65;
      color: rgba(255,255,255,.86);
      height: calc(100% - 126px);
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .log .line{ margin-bottom:10px; }
    .log .good{ color: rgba(0,255,255,.85); }
    .log .bad{ color: rgba(255,0,0,.75); }
    .log .warn{ color: rgba(255,255,255,.78); }

    /* timing bar */
    .timing{
      padding:14px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
    }
    .bar{
      height:14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.30);
      overflow:hidden;
      position:relative;
    }
    .zone{
      position:absolute; top:0; bottom:0;
      left:62%;
      width:14%;
      background: rgba(0,255,255,.22);
      box-shadow: 0 0 16px rgba(0,255,255,.20);
    }
    .needle{
      position:absolute; top:-6px;
      width:6px; height:26px;
      border-radius:4px;
      background: rgba(255,255,255,.88);
      box-shadow: 0 0 18px rgba(255,0,153,.22);
      left:0%;
      transform: translateX(-50%);
    }
    .timingHint{
      margin-top:10px;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.05em;
      color: rgba(255,255,255,.70);
      line-height:1.6;
    }

    /* controls bottom */
    .controls{
      position:fixed;
      left:14px; right:14px; bottom:14px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      z-index:60;
    }
    .act{
      padding:14px 12px;
      border-radius:16px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 0 18px rgba(255,0,153,.10);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      cursor:pointer;
      user-select:none;
    }
    .act.main{
      border:2px solid rgba(0,255,255,.35);
      box-shadow: 0 0 0 2px rgba(0,255,255,.08), 0 0 24px rgba(255,0,153,.12);
    }
    .act:active{ transform: translateY(1px); }
    .act[disabled]{ opacity:.45; cursor:not-allowed; }

    /* unlock modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      z-index:120;
    }
    .modal.show{ display:block; }
    .modal .backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.75);
      backdrop-filter: blur(6px);
    }
    .modal .box{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      width:min(92vw, 680px);
      border-radius:22px;
      border:1px solid rgba(0,255,255,.22);
      background: rgba(0,0,0,.62);
      box-shadow: 0 0 40px rgba(255,0,153,.14);
      padding:16px;
    }
    .modal .h{
      font-family:'Press Start 2P', monospace;
      letter-spacing:.08em;
      font-size:12px;
      line-height:1.6;
      margin:0 0 10px;
      text-transform: uppercase;
    }
    .modal .p{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      line-height:1.75;
      color: rgba(255,255,255,.84);
      margin:0 0 14px;
    }
    .modal .row{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .modal .row .btn2{
      flex:1;
      min-width: 160px;
      padding:14px 12px;
      border-radius:16px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.55);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      cursor:pointer;
    }
    .modal .row a.btn2{ text-decoration:none; display:flex; align-items:center; justify-content:center; }
    .modal .row .btn2.main{ border:2px solid rgba(0,255,255,.35); }
    .modal .row .btn2:active{ transform: translateY(1px); }

    /* responsive */
    @media (max-width: 900px){
      .battle{ grid-template-columns: 1fr; height:auto; }
      .cabinet{ height: min(78vh, 820px); }
      .controls{ grid-template-columns: 1fr 1fr; }
      .avatar{ width:88px; height:88px; }
      .cabHeader .big{ font-size:12px; }
    }
    @media (max-width: 420px){
      .title{ min-width: 220px; }
      .chip, .btn{ font-size:9px; padding:11px 12px; }
      .log{ font-size:9px; }
      .act{ font-size:9px; padding:13px 10px; }
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="crt"></div>
  <div class="vignette"></div>

  <div class="top">
    <a class="btn" href="index.html?v=1000">← VOLVER</a>
    <div class="chip title">FACTS // ARCADE QUEST</div>
    <button class="btn" id="musicBtn" type="button">SFX: ON</button>
  </div>

  <div class="stage">
    <div class="cabinet">
      <div class="cabHeader">
        <div class="chip big">DAYANARA — THE PARTY LEADER</div>
        <div class="statline">
          <div class="pill">HP: <span id="hp">10</span>/10</div>
          <div class="pill">XP: <span id="xp">0</span></div>
          <div class="pill">RUNES: <span id="wins">0</span>/3</div>
        </div>
      </div>

      <div class="battle">
        <!-- HERO PANEL -->
        <section class="panel">
          <div class="who">
            <div class="avatar">
              <!-- Cambia esta ruta si tu archivo tiene otro nombre -->
              <img id="heroImg" src="img/warrior.jpg" alt="Dayanara Hero">
            </div>
            <div class="meta">
              <div class="name">DAYANARA // HERO</div>
              <div class="sub">Clase: Paladin • Arma: Sword + Shield<br>Objetivo: 3 RUNES para abrir el archivo.</div>
            </div>
          </div>

          <div class="log" id="log"></div>

          <div class="timing">
            <div class="bar" aria-label="Timing bar">
              <div class="zone" id="zone"></div>
              <div class="needle" id="needle"></div>
            </div>
            <div class="timingHint">Tip: toca en el momento “CYAN” para CRIT. (Tap / Space / Enter)</div>
          </div>
        </section>

        <!-- ENEMY PANEL -->
        <section class="panel">
          <div class="who">
            <div class="avatar" style="box-shadow:0 0 18px rgba(255,0,0,.12);">
              <img id="enemyImg" src="img/Demogorgon.png" alt="Enemy">
            </div>
            <div class="meta">
              <div class="name" id="enemyName">ENEMY // DEMO</div>
              <div class="sub">Threat: <span id="enemyThreat">MED</span> • HP: <span id="enemyHp">8</span></div>
            </div>
          </div>

          <div class="log">
            <div class="line warn">INSERT COIN… ✅</div>
            <div class="line warn">Regla: gana 3 rondas. Entonces se desbloquea el Drive.</div>
            <div class="line warn">Si fallas el timing… Vecna se ríe.</div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <div class="controls">
    <button class="act main" id="attackBtn" type="button">ATACAR</button>
    <button class="act" id="defBtn" type="button">DEFENDER</button>
    <button class="act" id="spellBtn" type="button">HECHIZO</button>
    <button class="act" id="runBtn" type="button">RUN</button>
  </div>

  <!-- unlock modal -->
  <div class="modal" id="modal">
    <div class="backdrop"></div>
    <div class="box">
      <div class="h">ACCESS GRANTED</div>
      <div class="p">Desbloqueaste el archivo. Hawkins te deja pasar… por ahora.</div>
      <div class="row">
        <a class="btn2 main" id="openDrive" href="#" target="_blank" rel="noopener">ABRIR DRIVE</a>
        <button class="btn2" id="closeModal" type="button">VOLVER AL JUEGO</button>
      </div>
    </div>
  </div>

  <!-- (opcional) sfx silenciosos por ahora: iPhone necesita gesto igual -->
  <audio id="sfx" preload="auto"></audio>

  <script>
    // ===== CONFIG =====
    const DRIVE_URL = "https://drive.google.com/file/d/1PNAnsFPvncZiq-sJuf-fGuq8tRrIi2w6/view?usp=drivesdk";

    // ===== STATE =====
    const state = {
      hp: 10,
      xp: 0,
      wins: 0,
      enemy: null,
      busy: false,
      shield: 0,
      spellCd: 0,
      sfxOn: true,
      timing: { t: 0, dir: 1, speed: 0.9, last: 0, active: true, stopped: false, val: 0 }
    };

    const enemies = [
      { name: "DEMOBATS", hp: 7, threat: "LOW", img: "img/Demogorgon.png" },
      { name: "MIND FLAYER", hp: 9, threat: "MED", img: "img/Demogorgon.png" },
      { name: "VECNA'S ECHO", hp: 11, threat: "HIGH", img: "img/Demogorgon.png" }
    ];

    // ===== EL =====
    const elHp = document.getElementById("hp");
    const elXp = document.getElementById("xp");
    const elWins = document.getElementById("wins");
    const log = document.getElementById("log");

    const enemyName = document.getElementById("enemyName");
    const enemyThreat = document.getElementById("enemyThreat");
    const enemyHp = document.getElementById("enemyHp");
    const enemyImg = document.getElementById("enemyImg");

    const needle = document.getElementById("needle");
    const zone = document.getElementById("zone");

    const attackBtn = document.getElementById("attackBtn");
    const defBtn = document.getElementById("defBtn");
    const spellBtn = document.getElementById("spellBtn");
    const runBtn = document.getElementById("runBtn");

    const modal = document.getElementById("modal");
    const closeModal = document.getElementById("closeModal");
    const openDrive = document.getElementById("openDrive");

    const musicBtn = document.getElementById("musicBtn");

    // ===== UTIL =====
    function setText(el, v){ el.textContent = String(v); }
    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
    function randInt(a,b){ return Math.floor(a + Math.random()*(b-a+1)); }

    function pushLog(text, cls="warn"){
      const div = document.createElement("div");
      div.className = "line " + cls;
      div.textContent = text;
      log.prepend(div);
      // keep log reasonable
      while(log.children.length > 9) log.removeChild(log.lastChild);
    }

    function updateHud(){
      setText(elHp, state.hp);
      setText(elXp, state.xp);
      setText(elWins, state.wins);
      spellBtn.textContent = state.spellCd > 0 ? `HECHIZO (${state.spellCd})` : "HECHIZO";
      spellBtn.disabled = state.spellCd > 0 || state.busy;
      attackBtn.disabled = state.busy;
      defBtn.disabled = state.busy;
      runBtn.disabled = state.busy;
    }

    function spawnEnemy(){
      const pick = enemies[Math.min(enemies.length-1, Math.floor(state.wins/1))];
      // clone & randomize a bit
      state.enemy = {
        name: pick.name,
        hp: pick.hp + randInt(0,2),
        threat: pick.threat,
        img: pick.img
      };
      enemyName.textContent = "ENEMY // " + state.enemy.name;
      enemyThreat.textContent = state.enemy.threat;
      enemyHp.textContent = state.enemy.hp;
      enemyImg.src = state.enemy.img;

      pushLog(`NEW ENEMY: ${state.enemy.name}`, "warn");
    }

    // ===== TIMING BAR =====
    // Zone random per action so it feels alive
    function randomizeZone(){
      const left = randInt(52, 76);     // percent
      const width = randInt(10, 18);    // percent
      zone.style.left = left + "%";
      zone.style.width = width + "%";
      state.timing.zoneLeft = left;
      state.timing.zoneRight = left + width;
    }

    function timingStep(ts){
      if(!state.timing.last) state.timing.last = ts;
      const dt = Math.min(32, ts - state.timing.last);
      state.timing.last = ts;

      if(state.timing.active && !state.timing.stopped){
        state.timing.val += state.timing.dir * state.timing.speed * dt * 0.12; // %
        if(state.timing.val >= 100){ state.timing.val = 100; state.timing.dir = -1; }
        if(state.timing.val <= 0){ state.timing.val = 0; state.timing.dir = 1; }
        needle.style.left = state.timing.val + "%";
      }
      requestAnimationFrame(timingStep);
    }
    requestAnimationFrame(timingStep);

    function stopTimingAndJudge(){
      // stop once per action
      state.timing.stopped = true;
      const v = state.timing.val;
      const ok = (v >= state.timing.zoneLeft && v <= state.timing.zoneRight);
      return ok;
    }
    function resumeTiming(){
      state.timing.stopped = false;
      randomizeZone();
    }

    // Also allow Space/Enter to “stop”
    window.addEventListener("keydown", (e)=>{
      if(e.key === " " || e.key === "Enter"){
        // if action is waiting for timing, treat as press
        if(state.busy && state.waitingTiming) state.resolveTiming();
      }
    });

    // ===== ACTION FLOW =====
    function enemyHit(dmg){
      state.enemy.hp = Math.max(0, state.enemy.hp - dmg);
      enemyHp.textContent = state.enemy.hp;
      if(state.enemy.hp <= 0){
        state.wins += 1;
        state.xp += 5;
        pushLog("ENEMY DOWN. +1 RUNE.", "good");
        updateHud();

        if(state.wins >= 3){
          unlock();
          return;
        }
        spawnEnemy();
      }
    }

    function takeDamage(dmg){
      const reduced = Math.max(0, dmg - state.shield);
      state.shield = 0;
      state.hp = Math.max(0, state.hp - reduced);
      updateHud();
      if(reduced > 0) pushLog(`YOU TOOK ${reduced} DMG.`, "bad");
      else pushLog("BLOCKED.", "good");

      if(state.hp <= 0){
        // soft reset
        pushLog("YOU FELL… INSERT COIN AGAIN.", "bad");
        state.hp = 10;
        state.xp = Math.max(0, state.xp - 3);
        state.wins = Math.max(0, state.wins - 1);
        spawnEnemy();
        updateHud();
      }
    }

    function enemyTurn(){
      // enemy attacks after your action
      const base = state.enemy.threat === "HIGH" ? randInt(3,4) : state.enemy.threat === "MED" ? randInt(2,3) : randInt(1,2);
      takeDamage(base);
    }

    function startAction(label){
      if(state.busy) return;
      state.busy = true;
      state.waitingTiming = true;

      pushLog(`> ${label}: TIMING…`, "warn");

      // define resolveTiming once per action
      state.resolveTiming = () => {
        if(!state.waitingTiming) return;
        state.waitingTiming = false;

        const crit = stopTimingAndJudge();
        setTimeout(()=> resumeTiming(), 250);

        let dmg = 0;

        if(label === "ATACAR"){
          dmg = crit ? randInt(4,5) : randInt(2,3);
          pushLog(crit ? "GOOD CHOICE. CRIT HIT!" : "HIT.", crit ? "good":"warn");
          enemyHit(dmg);
        }

        if(label === "DEFENDER"){
          state.shield = crit ? 3 : 2;
          pushLog(crit ? "PERFECT GUARD." : "GUARD UP.", "good");
        }

        if(label === "HECHIZO"){
          dmg = crit ? randInt(5,6) : randInt(3,4);
          pushLog(crit ? "GOOD CHOICE. HOLY BLAST!" : "SPELL CAST.", crit ? "good":"warn");
          enemyHit(dmg);
          state.spellCd = 2;
        }

        if(label === "RUN"){
          const escaped = crit ? true : (Math.random() < 0.35);
          if(escaped){
            pushLog("ESCAPED. NEW ENEMY SPAWNS.", "good");
            spawnEnemy();
          }else{
            pushLog("FAILED TO RUN.", "bad");
          }
        }

        // cooldown tick
        if(state.spellCd > 0 && label !== "HECHIZO") state.spellCd -= 1;
        if(label === "HECHIZO") {} // already set

        // enemy response (unless you killed & unlocked)
        if(state.wins < 3 && state.enemy.hp > 0 && label !== "RUN"){
          enemyTurn();
        }

        state.busy = false;
        updateHud();
      };

      updateHud();
    }

    // click/tap to resolve timing ONLY when action active
    window.addEventListener("pointerdown", ()=>{
      if(state.busy && state.waitingTiming) state.resolveTiming();
    }, {passive:true});

    attackBtn.addEventListener("click", ()=> startAction("ATACAR"));
    defBtn.addEventListener("click", ()=> startAction("DEFENDER"));
    spellBtn.addEventListener("click", ()=> startAction("HECHIZO"));
    runBtn.addEventListener("click", ()=> startAction("RUN"));

    // ===== UNLOCK =====
    function unlock(){
      openDrive.href = DRIVE_URL;
      modal.classList.add("show");
    }
    closeModal.addEventListener("click", ()=> modal.classList.remove("show"));
    modal.querySelector(".backdrop").addEventListener("click", ()=> modal.classList.remove("show"));

    // ===== SFX TOGGLE (placeholder) =====
    function updateSfxBtn(){
      musicBtn.textContent = state.sfxOn ? "SFX: ON" : "SFX: OFF";
    }
    musicBtn.addEventListener("click", ()=>{
      state.sfxOn = !state.sfxOn;
      updateSfxBtn();
    });
    updateSfxBtn();

    // ===== INIT =====
    randomizeZone();
    spawnEnemy();
    pushLog("INSERT COIN… READY.", "good");
    pushLog("Win 3 RUNES to unlock the file.", "warn");
    updateHud();
  </script>
</body>
</html>
