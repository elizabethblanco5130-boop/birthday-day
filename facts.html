<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ARCADE QUEST ‚Äî Dayanara</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #000;
      --panel: rgba(0,0,0,.55);
      --panel2: rgba(0,0,0,.35);
      --line: rgba(255,255,255,.14);
      --neon1: rgba(0,255,255,.70);
      --neon2: rgba(255,0,153,.75);
      --neon3: rgba(255,255,0,.65);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.76);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:#000;
      color:#fff;
      font-family: system-ui, -apple-system, Arial;
      overflow-x:hidden;
    }

    /* ===== BACKGROUND SLOT (YOU WILL REPLACE) ===== */
    .bg-slot{
      position:fixed; inset:0;
      z-index:0;
      background:#000;
    }
    /* Deja esto: t√∫ luego pones background-image/video aqu√≠ */
    .bg-slot::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,0,153,.14), rgba(0,0,0,.80)),
        radial-gradient(circle at 70% 70%, rgba(0,255,255,.10), rgba(0,0,0,.88));
      opacity:.85;
      pointer-events:none;
    }

    /* CRT scanlines */
    .crt{
      position:fixed; inset:0;
      z-index:5;
      pointer-events:none;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,.05),
          rgba(255,255,255,.05) 1px,
          rgba(0,0,0,0) 3px,
          rgba(0,0,0,0) 6px
        );
      opacity:.10;
      mix-blend-mode: overlay;
    }

    .vignette{
      position:fixed; inset:0;
      z-index:6;
      pointer-events:none;
      background: radial-gradient(ellipse at center, rgba(0,0,0,.08), rgba(0,0,0,.78));
    }

    /* ===== LAYOUT ===== */
    .wrap{
      position:relative;
      z-index:10;
      min-height:100%;
      padding:16px 14px 18px;
      display:grid;
      place-items:center;
    }

    .cabinet{
      width:min(1100px, 96vw);
      border-radius:26px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      box-shadow:
        0 0 0 2px rgba(255,0,153,.10),
        0 0 40px rgba(255,0,153,.10),
        0 0 34px rgba(0,255,255,.08);
      overflow:hidden;
      position:relative;
    }

    /* Neon frame */
    .cabinet::before{
      content:"";
      position:absolute; inset:0;
      border-radius:26px;
      pointer-events:none;
      box-shadow:
        inset 0 0 0 2px rgba(0,255,255,.12),
        inset 0 0 0 1px rgba(255,0,153,.10);
    }

    /* Header */
    .top{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.45);
    }

    .title{
      font-family:'Press Start 2P', monospace;
      font-size:14px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--txt);
      text-shadow:
        0 0 16px rgba(255,0,153,.18),
        2px 0 rgba(0,255,255,.14),
        -2px 0 rgba(255,0,153,.14);
    }

    .pill{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      color: rgba(255,255,255,.86);
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      user-select:none;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .btnLink{
      text-decoration:none;
      color:#fff;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      padding:10px 12px;
      border-radius:14px;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .btnLink:active{ transform: translateY(1px); }

    /* Main grid */
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
      padding:14px;
    }

    /* Left: screen */
    .screen{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.45);
      box-shadow: inset 0 0 0 1px rgba(255,0,153,.06);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height:420px;
    }

    .screenHdr{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }

    .userTag{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .avatar{
      width:42px; height:42px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(0,255,255,.14), rgba(0,0,0,.55));
      display:grid;
      place-items:center;
      font-family:'Press Start 2P', monospace;
      font-size:12px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 0 14px rgba(0,255,255,.14);
    }

    .uname{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.90);
      line-height:1.5;
    }
    .role{
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      opacity:.82;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.78);
    }

    .bars{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .bar{
      width:190px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      overflow:hidden;
      padding:8px 10px;
    }
    .bar .lbl{
      font-family:'Press Start 2P', monospace;
      font-size:8px;
      letter-spacing:.06em;
      text-transform:uppercase;
      opacity:.88;
      margin-bottom:8px;
    }
    .meter{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
    }
    .fill{
      height:100%;
      width:50%;
      background: linear-gradient(90deg, rgba(0,255,255,.75), rgba(255,0,153,.70));
      box-shadow: 0 0 16px rgba(0,255,255,.12);
      transition: width .35s ease;
    }

    /* Narrative console */
    .console{
      margin-top:12px;
      border-radius:18px;
      border:1px dashed rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      padding:12px;
      min-height: 170px;
    }
    .consoleTitle{
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      text-transform:uppercase;
      opacity:.9;
      margin-bottom:10px;
    }
    .text{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      line-height:1.85;
      letter-spacing:.04em;
      color: rgba(255,255,255,.88);
      white-space:pre-wrap;
      min-height: 98px;
    }
    .caret{
      display:inline-block;
      width:10px; height:12px;
      margin-left:4px;
      background: rgba(255,255,255,.80);
      animation: blink .9s step-end infinite;
      vertical-align: -2px;
    }
    @keyframes blink{ 50%{ opacity:0; } }

    /* Combat area */
    .arena{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.30);
      padding:12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:center;
    }
    .enemy{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      padding:10px;
      min-height:92px;
      position:relative;
      overflow:hidden;
    }
    .enemyName{
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      text-transform:uppercase;
      opacity:.92;
      margin-bottom:8px;
    }
    .enemyHP{
      font-family:'Press Start 2P', monospace;
      font-size:8px;
      opacity:.85;
      letter-spacing:.06em;
      text-transform:uppercase;
      margin-top:8px;
    }

    .enemyMeter{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
    }
    .enemyFill{
      height:100%;
      width:100%;
      background: linear-gradient(90deg, rgba(255,0,153,.80), rgba(255,255,0,.55));
      transition: width .35s ease;
    }

    .qte{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      padding:10px;
      min-height:92px;
    }
    .qteTitle{
      font-family:'Press Start 2P', monospace;
      font-size:8px;
      letter-spacing:.06em;
      text-transform:uppercase;
      opacity:.85;
      margin-bottom:8px;
    }
    .qbar{
      height:12px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      position:relative;
    }
    .qtarget{
      position:absolute;
      left:60%;
      width:18%;
      top:0; bottom:0;
      background: rgba(255,255,0,.28);
      box-shadow: 0 0 18px rgba(255,255,0,.10);
    }
    .qdot{
      position:absolute;
      width:10px; height:12px;
      border-radius:999px;
      background: rgba(0,255,255,.75);
      left:0%;
      box-shadow: 0 0 18px rgba(0,255,255,.12);
    }

    .qbtn{
      margin-top:10px;
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      text-transform:uppercase;
      cursor:pointer;
    }
    .qbtn:active{ transform: translateY(1px); }

    /* Right: controls + inventory */
    .side{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.45);
      padding:14px;
      min-height:420px;
      overflow:hidden;
    }

    .menuTitle{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.08em;
      text-transform:uppercase;
      opacity:.92;
      margin-bottom:12px;
      text-shadow: 0 0 14px rgba(255,0,153,.14);
    }

    .actions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom:12px;
    }
    .abtn{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,0,153,.45);
      background: rgba(0,0,0,.35);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 0 18px rgba(255,0,153,.08);
      position:relative;
      overflow:hidden;
    }
    .abtn::after{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(90deg, rgba(0,255,255,.12), rgba(255,0,153,.14), rgba(0,255,255,.12));
      opacity:.18;
      filter: blur(10px);
      pointer-events:none;
    }
    .abtn.main{ border:2px solid rgba(0,255,255,.35); }
    .abtn:active{ transform: translateY(1px); }

    .inv{
      border-radius:18px;
      border:1px dashed rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      padding:12px;
      min-height: 180px;
    }
    .invHdr{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .invHdr .k{
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      text-transform:uppercase;
      opacity:.88;
    }
    .invList{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px;
    }
    .item{
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      padding:10px 10px;
      font-family:'Press Start 2P', monospace;
      font-size:8px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.86);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .item b{
      font-weight:700;
      color: rgba(255,255,255,.95);
    }

    .footer{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      padding:12px;
      font-family:'Press Start 2P', monospace;
      font-size:8px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.78);
      line-height:1.65;
      opacity:.92;
    }

    /* Sparks */
    .spark{
      position:fixed;
      width:10px; height:10px;
      border-radius:50%;
      background: rgba(255,0,153,.85);
      box-shadow: 0 0 14px rgba(255,0,153,.75), 0 0 24px rgba(0,255,255,.25);
      pointer-events:none;
      transform: translate(-50%,-50%);
      animation: pop .6s ease-out forwards;
      z-index:200;
    }
    @keyframes pop{
      from{ opacity:1; transform: translate(-50%,-50%) scale(.7); }
      to{ opacity:0; transform: translate(-50%,-50%) scale(3.2); }
    }

    /* Responsive */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .bar{ width: 100%; }
      .actions{ grid-template-columns: 1fr; }
      .arena{ grid-template-columns: 1fr; }
    }
    @media (max-width: 420px){
      .title{ font-size:12px; }
      .screen{ min-height: 420px; }
      .side{ min-height: 360px; }
      .invList{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- Background slot (you replace later) -->
  <div class="bg-slot" id="bgSlot"></div>

  <div class="crt"></div>
  <div class="vignette"></div>

  <div class="wrap">
    <div class="cabinet">

      <div class="top">
        <a class="btnLink" href="index.html?v=1000">‚Üê VOLVER</a>
        <div class="title">ARCADE QUEST</div>
        <div class="pill">
          <span>PLAYER:</span> <b id="playerName">DAYANARA</b>
          <span>TAG:</span> <b id="playerTag">@DAYA_DUNGEONRUN</b>
        </div>
      </div>

      <div class="grid">
        <!-- LEFT -->
        <section class="screen">
          <div class="screenHdr">
            <div class="userTag">
              <div class="avatar" id="avatar">D</div>
              <div>
                <div class="uname" id="uname">DAYANARA ANAHI</div>
                <div class="role" id="role">CLASS: THE BARD OF HAWKINS ‚Ä¢ LVL <span id="lvl">1</span></div>
              </div>
            </div>

            <div class="bars">
              <div class="bar">
                <div class="lbl">HP <span id="hpTxt">30/30</span></div>
                <div class="meter"><div class="fill" id="hpFill" style="width:100%"></div></div>
              </div>
              <div class="bar">
                <div class="lbl">MANA <span id="mpTxt">12/12</span></div>
                <div class="meter"><div class="fill" id="mpFill" style="width:100%"></div></div>
              </div>
              <div class="bar">
                <div class="lbl">XP <span id="xpTxt">0/20</span></div>
                <div class="meter"><div class="fill" id="xpFill" style="width:0%"></div></div>
              </div>
            </div>
          </div>

          <div class="console">
            <div class="consoleTitle">CONSOLE</div>
            <div class="text" id="text"></div><span class="caret" id="caret"></span>
          </div>

          <div class="arena">
            <div class="enemy">
              <div class="enemyName" id="enemyName">ENCOUNTER: DEMODOG</div>
              <div class="enemyMeter"><div class="enemyFill" id="enemyFill" style="width:100%"></div></div>
              <div class="enemyHP" id="enemyHP">HP 18/18</div>
            </div>

            <div class="qte">
              <div class="qteTitle">CRITICAL MINI-GAME (press STOP)</div>
              <div class="qbar" id="qbar">
                <div class="qtarget"></div>
                <div class="qdot" id="qdot"></div>
              </div>
              <button class="qbtn" id="qbtn" type="button">STOP</button>
            </div>
          </div>
        </section>

        <!-- RIGHT -->
        <aside class="side">
          <div class="menuTitle">COMMANDS</div>

          <div class="actions">
            <button class="abtn main" id="attackBtn" type="button">ATTACK</button>
            <button class="abtn" id="spellBtn" type="button">SPELL</button>
            <button class="abtn" id="itemBtn" type="button">ITEM</button>
            <button class="abtn" id="runBtn" type="button">RUN</button>
          </div>

          <div class="inv">
            <div class="invHdr">
              <div class="k">INVENTORY</div>
              <div class="k">GOLD: <span id="gold">15</span></div>
            </div>
            <div class="invList" id="invList">
              <div class="item"><span>üé≤ D20</span><b>1</b></div>
              <div class="item"><span>üìº MIXTAPE</span><b>1</b></div>
              <div class="item"><span>üóùÔ∏è KEY</span><b id="keys">0</b></div>
              <div class="item"><span>üß™ POTION</span><b id="pots">1</b></div>
            </div>
          </div>

          <div class="footer" id="footerHint">
            tip: usa SPELL cuando el enemigo est√© al 50% ‚Ä¢
            encuentra 2 llaves para abrir el portal final.
          </div>
        </aside>
      </div>

    </div>
  </div>

  <script>
    // ========== SPARK FX ==========
    function spark(x,y){
      const s = document.createElement("div");
      s.className = "spark";
      s.style.left = x + "px";
      s.style.top  = y + "px";
      document.body.appendChild(s);
      setTimeout(()=>s.remove(), 650);
    }
    document.addEventListener("click",(e)=>spark(e.clientX,e.clientY),{passive:true});

    // ========== GAME STATE ==========
    const state = {
      name: "DAYANARA",
      tag: "@DAYA_DUNGEONRUN",
      class: "BARD OF HAWKINS",
      lvl: 1,
      hp: 30, hpMax: 30,
      mp: 12, mpMax: 12,
      xp: 0, xpMax: 20,
      gold: 15,
      keys: 0,
      pots: 1,
      enemy: { name:"DEMODog", hp: 18, hpMax:18 },
      seenSecrets: new Set(),
      qteRunning: true,
      qpos: 0,
      qdir: 1,
      canAct: true
    };

    // UI refs
    const el = (id)=>document.getElementById(id);
    const hpTxt = el("hpTxt"), mpTxt = el("mpTxt"), xpTxt = el("xpTxt");
    const hpFill = el("hpFill"), mpFill = el("mpFill"), xpFill = el("xpFill");
    const lvl = el("lvl");
    const enemyName = el("enemyName"), enemyFill = el("enemyFill"), enemyHP = el("enemyHP");
    const text = el("text"), caret = el("caret");
    const keys = el("keys"), pots = el("pots"), gold = el("gold");
    const footerHint = el("footerHint");

    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
    function pct(cur,max){ return Math.round((cur/max)*100); }

    function render(){
      hpTxt.textContent = `${state.hp}/${state.hpMax}`;
      mpTxt.textContent = `${state.mp}/${state.mpMax}`;
      xpTxt.textContent = `${state.xp}/${state.xpMax}`;
      hpFill.style.width = pct(state.hp,state.hpMax) + "%";
      mpFill.style.width = pct(state.mp,state.mpMax) + "%";
      xpFill.style.width = pct(state.xp,state.xpMax) + "%";
      lvl.textContent = state.lvl;

      enemyName.textContent = `ENCOUNTER: ${state.enemy.name.toUpperCase()}`;
      enemyFill.style.width = pct(state.enemy.hp,state.enemy.hpMax) + "%";
      enemyHP.textContent = `HP ${state.enemy.hp}/${state.enemy.hpMax}`;

      keys.textContent = state.keys;
      pots.textContent = state.pots;
      gold.textContent = state.gold;
    }

    // ========== TYPING TEXT ==========
    let typing = false;
    const queue = [];
    function say(msg){
      queue.push(msg);
      if(!typing) runQueue();
    }
    async function runQueue(){
      typing = true;
      while(queue.length){
        const msg = queue.shift();
        await typeMsg(msg);
        await sleep(220);
      }
      typing = false;
    }
    function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
    async function typeMsg(msg){
      caret.style.display = "inline-block";
      text.textContent = "";
      for(let i=0;i<msg.length;i++){
        text.textContent += msg[i];
        await sleep(10 + Math.random()*18);
      }
      caret.style.display = "none";
    }

    // ========== QTE ==========
    const qdot = el("qdot");
    let qAnim = null;
    function startQTE(){
      if(qAnim) cancelAnimationFrame(qAnim);
      state.qteRunning = true;
      function step(){
        if(!state.qteRunning) return;
        state.qpos += state.qdir * 1.6;
        if(state.qpos >= 100){ state.qpos = 100; state.qdir = -1; }
        if(state.qpos <= 0){ state.qpos = 0; state.qdir = 1; }
        qdot.style.left = `calc(${state.qpos}% - 5px)`;
        qAnim = requestAnimationFrame(step);
      }
      step();
    }
    startQTE();

    function checkQTE(){
      // target is approx 60%..78% based on CSS .qtarget
      const good = (state.qpos >= 60 && state.qpos <= 78);
      return good ? 2 : 1; // crit multiplier
    }

    // ========== COMBAT ==========
    function enemyTurn(){
      if(state.enemy.hp <= 0) return;
      const dmg = Math.floor(2 + Math.random()*5); // 2..6
      state.hp = clamp(state.hp - dmg, 0, state.hpMax);
      render();
      say(`ENEMY STRIKES!\n-${dmg} HP.\n\n(Stay loud. Keep moving.)`);

      if(state.hp <= 0){
        state.canAct = false;
        say(`GAME OVER.\n\nDayanara respawns at the arcade.\nPress RUN to restart.`);
      }
    }

    function winFight(){
      state.canAct = false;
      const gain = 9 + Math.floor(Math.random()*6); // 9..14
      state.xp += gain;
      state.gold += 7;
      state.keys += (Math.random() < 0.5 ? 1 : 0);

      // level up
      while(state.xp >= state.xpMax){
        state.xp -= state.xpMax;
        state.lvl++;
        state.xpMax += 10;
        state.hpMax += 6;
        state.mpMax += 3;
        state.hp = state.hpMax;
        state.mp = state.mpMax;
      }

      render();
      say(`VICTORY!\n+${gain} XP ‚Ä¢ +7 GOLD\n\nLOOT CHECK: KEY? ${state.keys>0?"YES":"NO"}\nPress ATTACK to continue.`);
    }

    function spawnEnemy(){
      const pool = [
        { name:"Demodog", hp:18 },
        { name:"Mind-Spore", hp:16 },
        { name:"Bat Swarm", hp:20 },
        { name:"Mini-Vecna Echo", hp:22 }
      ];
      const pick = pool[Math.floor(Math.random()*pool.length)];
      state.enemy = { name: pick.name, hp: pick.hp, hpMax: pick.hp };
      state.canAct = true;
      render();
      say(`NEW ENCOUNTER!\n${pick.name.toUpperCase()} appears.\n\nChoose your move.`);
    }

    // Actions
    el("attackBtn").addEventListener("click", ()=>{
      if(!state.canAct){
        // if victory screen, continue
        spawnEnemy();
        return;
      }
      const mult = checkQTE();
      const base = 4 + Math.floor(Math.random()*5); // 4..8
      const dmg = base * mult;

      state.enemy.hp = clamp(state.enemy.hp - dmg, 0, state.enemy.hpMax);
      render();

      say(mult===2
        ? `CRITICAL HIT!\n-${dmg} DMG.\n\nDayanara swings like a legend.`
        : `ATTACK!\n-${dmg} DMG.\n\nArcade lights flicker...`
      );

      if(state.enemy.hp <= 0){
        winFight();
        return;
      }
      setTimeout(enemyTurn, 520);
    });

    el("spellBtn").addEventListener("click", ()=>{
      if(!state.canAct) return;
      if(state.mp < 4){
        say("NOT ENOUGH MANA.\n\nFind a mixtape or use an item.");
        return;
      }
      state.mp -= 4;
      const dmg = 8 + Math.floor(Math.random()*7); // 8..14
      state.enemy.hp = clamp(state.enemy.hp - dmg, 0, state.enemy.hpMax);
      render();
      say(`SPELL: ‚ÄúSONG OF RETURN‚Äù\n-${dmg} DMG.\n\nGood choice.`);
      if(state.enemy.hp <= 0){
        winFight();
        return;
      }
      setTimeout(enemyTurn, 520);
    });

    el("itemBtn").addEventListener("click", ()=>{
      if(!state.canAct){
        say("NO ITEMS RIGHT NOW.\nPress ATTACK to continue.");
        return;
      }
      if(state.pots <= 0){
        say("NO POTIONS.\n\nTry SPELL or RUN.");
        return;
      }
      state.pots--;
      state.hp = clamp(state.hp + 14, 0, state.hpMax);
      render();
      say("ITEM: POTION\n+14 HP.\n\nDayanara refuses to go down.");
      setTimeout(enemyTurn, 520);
    });

    el("runBtn").addEventListener("click", ()=>{
      // restart if dead
      if(state.hp <= 0){
        state.hp = 30; state.hpMax = 30;
        state.mp = 12; state.mpMax = 12;
        state.xp = 0; state.xpMax = 20;
        state.lvl = 1;
        state.gold = 15;
        state.keys = 0;
        state.pots = 1;
        spawnEnemy();
        return;
      }

      if(!state.canAct){
        spawnEnemy();
        return;
      }

      const ok = Math.random() < 0.55;
      if(ok){
        say("ESCAPE SUCCESS.\n\nYou slip into the arcade crowd.");
        spawnEnemy();
      }else{
        say("ESCAPE FAILED.\n\nThe enemy closes in!");
        setTimeout(enemyTurn, 520);
      }
    });

    // QTE button
    el("qbtn").addEventListener("click", ()=>{
      const good = (state.qpos >= 60 && state.qpos <= 78);
      say(good ? "TIMING: PERFECT.\nCritical ready." : "TIMING: OK.\nNormal hit.");
    });

    // ========== SECRETS (Easter eggs) ==========
    // Tap the title 7 times => +1 key, +gold, message
    let taps = 0;
    document.querySelector(".title").addEventListener("click", ()=>{
      taps++;
      if(taps >= 7){
        taps = 0;
        state.keys++;
        state.gold += 10;
        render();
        say("SECRET FOUND!\n+1 KEY ‚Ä¢ +10 GOLD\n\n(Arcade remembers you.)");
      }
    });

    // ========== INTRO ==========
    render();
    say("INSERT COIN.\n\nPLAYER: DAYANARA\nCLASS: BARD OF HAWKINS\n\nPress ATTACK to start.");
  </script>
</body>
</html>
