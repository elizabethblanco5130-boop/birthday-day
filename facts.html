<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>FACTS — Arcade Quest</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/benguiat" rel="stylesheet">

  <style>
    :root{
      --bg: radial-gradient(circle at 30% 20%, rgba(255,0,153,.14), rgba(0,0,0,.90)),
            radial-gradient(circle at 80% 70%, rgba(0,255,255,.10), rgba(0,0,0,.92));
      --glass: rgba(0,0,0,.46);
      --red: rgba(255,0,0,.70);
      --pink: rgba(255,0,153,.75);
      --cyan: rgba(0,255,255,.35);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --line: rgba(255,255,255,.12);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:#000;
      color:#fff;
      overflow:hidden;
      font-family: system-ui, -apple-system, Arial;
    }

    /* ===== BACKGROUND (you can swap later) ===== */
    .bg{
      position:fixed; inset:0;
      background: var(--bg);
      z-index:0;
    }
    .vignette{
      position:fixed; inset:0;
      background:
        radial-gradient(ellipse at 45% 35%, rgba(0,0,0,.04), rgba(0,0,0,.78)),
        radial-gradient(ellipse at 75% 65%, rgba(0,0,0,.20), rgba(0,0,0,.92));
      pointer-events:none;
      z-index:2;
    }
    .noise{
      position:fixed; inset:0;
      opacity:.10;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.65'/%3E%3C/svg%3E");
      pointer-events:none;
      z-index:3;
    }

    /* ===== FX CANVAS ===== */
    canvas#fx{
      position:fixed; inset:0;
      z-index:4;
      pointer-events:none;
    }

    /* ===== TOP HUD ===== */
    .top{
      position:fixed;
      top:14px; left:14px; right:14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      z-index:30;
      flex-wrap:wrap;
    }

    .chip{
      border:1px solid rgba(255,0,153,.35);
      background: rgba(0,0,0,.40);
      backdrop-filter: blur(10px);
      border-radius:16px;
      padding:10px 12px;
      box-shadow: 0 0 22px rgba(255,0,153,.10);
    }

    .back{
      text-decoration:none;
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 120px;
    }

    .title{
      flex:1;
      min-width: 220px;
      text-align:center;
      font-family: 'Benguiat', serif;
      letter-spacing:.10em;
      text-transform: uppercase;
      font-size:18px;
      color: rgba(255,255,255,.92);
      text-shadow:
        0 0 18px rgba(255,0,153,.16),
        2px 0 rgba(0,255,255,.10),
        -2px 0 rgba(255,0,0,.10);
      padding:10px 12px;
    }

    .musicBtn{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      cursor:pointer;
      user-select:none;
      min-width: 140px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    .musicBtn:active{ transform: translateY(1px); }

    /* ===== MAIN STAGE ===== */
    .stage{
      position:fixed; inset:0;
      z-index:20;
      display:grid;
      place-items:center;
      padding:84px 14px 98px;
    }

    .panel{
      width:min(1100px, 96vw);
      height:min(76vh, 720px);
      border-radius:24px;
      border:1px solid rgba(255,0,153,.35);
      background: rgba(0,0,0,.42);
      backdrop-filter: blur(10px);
      box-shadow:
        0 0 0 2px rgba(255,0,153,.06),
        0 0 36px rgba(255,0,153,.12),
        0 0 30px rgba(0,255,255,.08);
      overflow:hidden;
      position:relative;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
    }

    .left{
      position:relative;
      padding:16px;
      border-right:1px solid rgba(255,255,255,.08);
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }

    .right{
      position:relative;
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }

    .arcadeHdr{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      border-radius:18px;
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .arcadeHdr .mode{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.85);
      opacity:.95;
      white-space:nowrap;
    }

    .arcadeHdr .status{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(0,255,255,.80);
      text-shadow: 0 0 12px rgba(0,255,255,.18);
      text-align:right;
      flex:1;
    }

    /* ===== BATTLE ARENA ===== */
    .arena{
      flex:1;
      min-height:0;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(circle at 40% 30%, rgba(255,0,153,.10), rgba(0,0,0,.45)),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.55));
      position:relative;
      overflow:hidden;
    }

    .gridlines{
      position:absolute; inset:-40%;
      background:
        linear-gradient(0deg, rgba(0,255,255,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,0,153,.06) 1px, transparent 1px);
      background-size: 48px 48px;
      transform: rotate(8deg);
      opacity:.45;
      pointer-events:none;
      filter: blur(.2px);
    }

    .neonScan{
      position:absolute; inset:-40%;
      background: linear-gradient(120deg, rgba(255,0,153,0), rgba(255,0,153,.12), rgba(0,255,255,.10), rgba(255,0,153,0));
      filter: blur(16px);
      opacity:.45;
      animation: scan 7s linear infinite;
      pointer-events:none;
    }
    @keyframes scan{
      0%{ transform: translateX(-18%) translateY(-10%) rotate(6deg); }
      100%{ transform: translateX(18%) translateY(10%) rotate(6deg); }
    }

    .entity{
      position:absolute;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
    }

    .sprite{
      width: min(34vw, 260px);
      max-width: 260px;
      height:auto;
      filter: drop-shadow(0 0 18px rgba(255,0,153,.20));
      will-change: transform;
    }

    .enemySprite{
      width: min(26vw, 200px);
      max-width: 200px;
      height:auto;
      filter: drop-shadow(0 0 18px rgba(255,0,0,.20));
      opacity:.95;
      will-change: transform;
    }

    .nameplate{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      text-align:center;
      min-width: 160px;
      max-width: 92%;
    }
    .nameplate .n{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.90);
    }
    .nameplate .sub{
      margin-top:6px;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.04em;
      color: rgba(255,255,255,.72);
      line-height:1.55;
    }

    /* positions */
    .hero{ left:6%; bottom:10%; }
    .enemy{ right:6%; top:10%; }
    .enemy2{ right:10%; bottom:16%; opacity:.92; }

    /* HP bars */
    .bars{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:2px;
    }
    .bar{
      flex:1;
      min-width: 220px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
      padding:10px 10px;
    }
    .bar .label{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: rgba(255,255,255,.82);
    }
    .meter{
      margin-top:8px;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
    }
    .fill{
      height:100%;
      width:50%;
      background: linear-gradient(90deg, rgba(0,255,255,.40), rgba(255,0,153,.55));
      box-shadow: 0 0 18px rgba(255,0,153,.15);
    }
    .fill.enemyFill{
      background: linear-gradient(90deg, rgba(255,0,0,.55), rgba(255,0,153,.35));
      box-shadow: 0 0 18px rgba(255,0,0,.12);
    }

    /* ===== RIGHT SIDE (QUEST LOG + BUTTONS) ===== */
    .quest{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
      padding:14px 14px;
    }
    .quest .h{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,.90);
    }
    .quest .t{
      margin-top:10px;
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      line-height:1.8;
      color: rgba(255,255,255,.76);
    }
    .quest .t b{
      color: rgba(0,255,255,.82);
      font-weight:700;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn{
      flex:1;
      min-width: 170px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.40);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 18px rgba(255,0,153,.10);
      touch-action: manipulation;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.main{
      border:2px solid rgba(0,255,255,.35);
      box-shadow: 0 0 0 2px rgba(0,255,255,.10), 0 0 26px rgba(255,0,153,.12);
    }

    .log{
      flex:1;
      min-height:0;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      backdrop-filter: blur(10px);
      padding:12px 12px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .log .line{
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      line-height:1.8;
      color: rgba(255,255,255,.78);
      margin:0 0 10px;
    }
    .log .line.good{ color: rgba(0,255,255,.78); }
    .log .line.bad{ color: rgba(255,0,0,.78); }

    /* ===== VICTORY OVERLAY ===== */
    .overlay{
      position:fixed; inset:0;
      display:none;
      z-index:90;
    }
    .overlay.show{ display:block; }
    .overlay .backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.75);
      backdrop-filter: blur(6px);
    }
    .overlay .box{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      width:min(92vw, 720px);
      border-radius:22px;
      border:1px solid rgba(255,0,153,.35);
      background: rgba(0,0,0,.55);
      box-shadow:
        0 0 0 2px rgba(0,255,255,.08),
        0 0 44px rgba(255,0,153,.18);
      padding:16px;
      overflow:hidden;
    }
    .victoryTitle{
      margin:0;
      font-family:'Benguiat', serif;
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size:26px;
      color: rgba(255,255,255,.92);
      text-shadow: 0 0 18px rgba(255,0,153,.20);
    }
    .victorySub{
      margin:10px 0 0;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      line-height:1.9;
      color: rgba(255,255,255,.78);
    }

    .unlockBtn{
      margin-top:14px;
      width:100%;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .neonLink{
      flex:1;
      min-width: 240px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:14px 16px;
      border-radius:16px;
      text-decoration:none;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,.95);
      border:2px solid rgba(0,255,255,.40);
      background:
        radial-gradient(circle at 30% 25%, rgba(0,255,255,.18), rgba(0,0,0,.55)),
        linear-gradient(90deg, rgba(255,0,153,.15), rgba(0,255,255,.08), rgba(255,0,153,.15));
      box-shadow:
        0 0 0 2px rgba(0,255,255,.10),
        0 0 24px rgba(0,255,255,.18),
        0 0 44px rgba(255,0,153,.16);
      animation: neonPulse 1.2s ease-in-out infinite;
    }
    @keyframes neonPulse{
      0%,100%{ filter: brightness(1.0); }
      50%{ filter: brightness(1.25); }
    }

    .closeOverlay{
      flex:1;
      min-width: 170px;
      padding:14px 16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      cursor:pointer;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 900px){
      .panel{ grid-template-columns: 1fr; height:min(80vh, 860px); }
      .left{ border-right:none; border-bottom:1px solid rgba(255,255,255,.08); }
      .hero{ left:4%; bottom:8%; }
      .enemy{ right:4%; top:8%; }
      .enemy2{ right:6%; bottom:14%; }
      .sprite{ width:min(44vw, 260px); }
      .enemySprite{ width:min(34vw, 200px); }
    }

    @media (max-width: 520px){
      .title{ font-size:14px; }
      .panel{ height: 82vh; }
      .nameplate{ min-width: 140px; }
      .bars .bar{ min-width: 100%; }
      .btn{ min-width: 140px; }
      .log{ max-height: 160px; }
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="vignette"></div>
  <div class="noise"></div>
  <canvas id="fx"></canvas>

  <!-- MUSIC (starts on first real tap) -->
  <audio id="bgm" loop preload="auto">
    <source src="runaway.mp3" type="audio/mpeg">
  </audio>

  <div class="top">
    <a class="chip back" href="index.html?v=1000">← BACK</a>
    <div class="chip title">DUNGEONS & DRAGONS — ARCADE RUN</div>
    <button class="chip musicBtn" id="musicBtn" type="button">MUSIC: OFF</button>
  </div>

  <div class="stage">
    <div class="panel">
      <div class="left">
        <div class="arcadeHdr">
          <div class="mode">PLAYER: DAYANARA_80S</div>
          <div class="status" id="status">INSERT COIN → TAP TO START</div>
        </div>

        <div class="bars">
          <div class="bar">
            <div class="label">
              <span>DAYANARA (WARRIOR)</span>
              <span id="hpHeroTxt">HP 100/100</span>
            </div>
            <div class="meter"><div class="fill" id="hpHero"></div></div>
          </div>
          <div class="bar">
            <div class="label">
              <span>ENEMIES</span>
              <span id="hpEnemyTxt">HP 120/120</span>
            </div>
            <div class="meter"><div class="fill enemyFill" id="hpEnemy"></div></div>
          </div>
        </div>

        <div class="arena" id="arena">
          <div class="gridlines"></div>
          <div class="neonScan"></div>

          <!-- HERO -->
          <div class="entity hero" id="heroEnt">
            <img class="sprite" id="heroImg" src="img/warrior.PNG" alt="Dayanara Warrior">
            <div class="nameplate">
              <div class="n">DAYANARA</div>
              <div class="sub">Class: Warrior · Realm: Hawkins Arcade</div>
            </div>
          </div>

          <!-- ENEMY 1: Demobats -->
          <div class="entity enemy" id="enemyEnt">
            <img class="enemySprite" id="enemyImg" src="img/demobat.png" alt="Demobats">
            <div class="nameplate">
              <div class="n">DEMOBATS</div>
              <div class="sub">Swarm · Weak to “NEON STRIKE”</div>
            </div>
          </div>

          <!-- ENEMY 2: Vecna -->
          <div class="entity enemy2" id="enemyEnt2">
            <img class="enemySprite" id="enemyImg2" src="img/enemigo2.png" alt="Vecna">
            <div class="nameplate">
              <div class="n">VECNA</div>
              <div class="sub">Boss · Don’t miss.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="quest">
          <div class="h">QUEST LOG</div>
          <div class="t" id="questTxt">
            <b>Objective:</b> Defeat the creatures guarding the portal.<br>
            <b>Reward:</b> Unlock the “FACTS” video link.<br>
            Tip: You can <b>Attack</b>, <b>Heal</b>, or <b>Charge</b> (builds a critical hit).
          </div>
        </div>

        <div class="actions">
          <button class="btn main" id="attackBtn" type="button">ATTACK</button>
          <button class="btn" id="healBtn" type="button">HEAL</button>
          <button class="btn" id="chargeBtn" type="button">CHARGE</button>
          <button class="btn" id="resetBtn" type="button">RESTART</button>
        </div>

        <div class="log" id="log" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Victory overlay -->
  <div class="overlay" id="overlay">
    <div class="backdrop"></div>
    <div class="box">
      <h2 class="victoryTitle">PORTAL UNLOCKED</h2>
      <div class="victorySub" id="victoryText">
        You didn’t just win — you glitched the system.<br>
        Hawkins blinked first. Now the file is yours.
      </div>

      <div class="unlockBtn">
        <a class="neonLink" id="driveLink" href="https://drive.google.com/file/d/1PNAnsFPvncZiq-sJuf-fGuq8tRrIi2w6/view?usp=drivesdk" target="_blank" rel="noopener">
          OPEN THE FILE
        </a>
        <button class="closeOverlay" id="closeOverlay" type="button">CLOSE</button>
      </div>
    </div>
  </div>

  <script>
    // ====== Music (iPhone safe) ======
    const bgm = document.getElementById("bgm");
    const musicBtn = document.getElementById("musicBtn");
    let musicOn = false;
    let musicStarted = false;

    function updateMusicBtn(){
      musicBtn.textContent = musicOn ? "MUSIC: ON" : "MUSIC: OFF";
    }

    function startMusic(){
      if(!bgm) return;
      if(!musicStarted){
        bgm.volume = 0.55;
        musicStarted = true;
      }
      bgm.play().catch(()=>{});
      musicOn = true;
      updateMusicBtn();
    }

    function stopMusic(){
      if(!bgm) return;
      bgm.pause();
      musicOn = false;
      updateMusicBtn();
    }

    // Start on any real interaction
    ["pointerdown","touchstart","click","keydown"].forEach(evt=>{
      window.addEventListener(evt, () => { if(!musicOn) startMusic(); }, {passive:true});
    });

    musicBtn.addEventListener("click", (e)=>{
      e.preventDefault();
      if(!musicOn) startMusic();
      else stopMusic();
    });
    updateMusicBtn();

    // ====== FX Canvas (lightning + sparks) ======
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");
    let W=0,H=0,dpr=1;

    function resize(){
      dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);
      canvas.width = Math.floor(W*dpr);
      canvas.height = Math.floor(H*dpr);
      canvas.style.width = W+"px";
      canvas.style.height = H+"px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    window.addEventListener("resize", resize);
    resize();

    const fx = [];
    function rand(a,b){ return a + Math.random()*(b-a); }

    function sparkBurst(x,y, color="rgba(0,255,255,.65)"){
      for(let i=0;i<22;i++){
        fx.push({
          type:"spark",
          x,y,
          vx: rand(-3.2, 3.2),
          vy: rand(-4.0, 1.0),
          life: rand(18, 34),
          r: rand(1.2, 2.6),
          color
        });
      }
    }

    function lightningFlash(color="rgba(255,0,0,.55)"){
      fx.push({ type:"flash", life: 10, color });
      // a jagged bolt
      const x0 = rand(W*0.35, W*0.75);
      let x=x0, y=-20;
      const segs = [];
      while(y < H*0.9){
        const nx = x + rand(-42, 42);
        const ny = y + rand(40, 90);
        segs.push([x,y,nx,ny]);
        x = nx; y = ny;
      }
      fx.push({ type:"bolt", segs, life: 14, color });
    }

    function drawFX(){
      ctx.clearRect(0,0,W,H);

      for(let i=fx.length-1;i>=0;i--){
        const p = fx[i];
        p.life -= 1;

        if(p.type === "flash"){
          ctx.save();
          ctx.globalAlpha = Math.max(0, p.life/10) * 0.35;
          ctx.fillStyle = p.color;
          ctx.fillRect(0,0,W,H);
          ctx.restore();
        }

        if(p.type === "bolt"){
          ctx.save();
          ctx.globalAlpha = Math.max(0, p.life/14) * 0.95;
          ctx.lineWidth = 2.5;
          ctx.strokeStyle = p.color;
          ctx.shadowColor = p.color;
          ctx.shadowBlur = 18;
          ctx.beginPath();
          for(const [x1,y1,x2,y2] of p.segs){
            ctx.moveTo(x1,y1);
            ctx.lineTo(x2,y2);
          }
          ctx.stroke();
          ctx.restore();
        }

        if(p.type === "spark"){
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.12; // gravity

          ctx.save();
          ctx.globalAlpha = Math.max(0, p.life/34);
          ctx.fillStyle = p.color;
          ctx.shadowColor = p.color;
          ctx.shadowBlur = 12;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fill();
          ctx.restore();
        }

        if(p.life <= 0) fx.splice(i,1);
      }

      requestAnimationFrame(drawFX);
    }
    drawFX();

    // ====== Game State ======
    const statusEl = document.getElementById("status");
    const logEl = document.getElementById("log");

    const hpHeroFill = document.getElementById("hpHero");
    const hpEnemyFill = document.getElementById("hpEnemy");
    const hpHeroTxt = document.getElementById("hpHeroTxt");
    const hpEnemyTxt = document.getElementById("hpEnemyTxt");

    const heroEnt = document.getElementById("heroEnt");
    const enemyEnt = document.getElementById("enemyEnt");
    const enemyEnt2 = document.getElementById("enemyEnt2");

    const attackBtn = document.getElementById("attackBtn");
    const healBtn = document.getElementById("healBtn");
    const chargeBtn = document.getElementById("chargeBtn");
    const resetBtn = document.getElementById("resetBtn");

    const overlay = document.getElementById("overlay");
    const closeOverlay = document.getElementById("closeOverlay");
    const victoryText = document.getElementById("victoryText");

    let heroMax = 100;
    let enemyMax = 120;

    let heroHP = heroMax;
    let enemyHP = enemyMax;

    let started = false;
    let locked = false;
    let charge = 0; // 0..3 for crit
    let bossPhase = 0; // 0 demobats, 1 vecna (visual + flavor)

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function setBars(){
      hpHeroTxt.textContent = `HP ${heroHP}/${heroMax}`;
      hpEnemyTxt.textContent = `HP ${enemyHP}/${enemyMax}`;
      hpHeroFill.style.width = (heroHP/heroMax*100) + "%";
      hpEnemyFill.style.width = (enemyHP/enemyMax*100) + "%";
    }

    function log(msg, kind=""){
      const p = document.createElement("div");
      p.className = "line" + (kind ? " " + kind : "");
      p.textContent = msg;
      logEl.prepend(p);
    }

    function setStatus(msg){
      statusEl.textContent = msg;
    }

    function startGame(){
      if(started) return;
      started = true;
      setStatus("QUEST STARTED — FIGHT!");
      log("INSERT COIN accepted. The arcade wakes up…", "good");
      log("Objective: defeat the guardians to unlock the file.", "");
    }

    function enemyAttack(){
      // small randomness; harder if bossPhase = 1
      const base = bossPhase ? rand(10, 16) : rand(8, 13);
      const dmg = Math.floor(base);
      heroHP = clamp(heroHP - dmg, 0, heroMax);

      // effects
      sparkBurst(W*0.25, H*0.55, "rgba(255,0,0,.55)");
      heroEnt.animate(
        [{ transform:"translateX(0)" }, { transform:"translateX(-6px)" }, { transform:"translateX(0)" }],
        { duration: 180 }
      );

      log(`Enemy hits back for ${dmg} DMG.`, "bad");
      if(heroHP <= 0){
        setStatus("GAME OVER — TRY AGAIN");
        log("You fell. The portal stays locked.", "bad");
        locked = true;
      }
      setBars();
    }

    function maybePhaseSwap(){
      // purely visual drama: when enemy HP below 55%, show Vecna stronger presence
      if(!bossPhase && enemyHP <= Math.floor(enemyMax*0.55)){
        bossPhase = 1;
        enemyEnt2.animate(
          [{ transform:"translateY(0) scale(1)" }, { transform:"translateY(-8px) scale(1.04)" }, { transform:"translateY(0) scale(1)" }],
          { duration: 600 }
        );
        setStatus("BOSS PHASE — VECNA APPROACHES");
        log("The air drops. Vecna is watching.", "bad");
        lightningFlash("rgba(255,0,0,.45)");
      }
    }

    function victory(){
      locked = true;
      setStatus("VICTORY — FILE UNLOCKED");
      log("You broke the guard. The portal unlocks.", "good");

      // mega fx
      lightningFlash("rgba(0,255,255,.35)");
      lightningFlash("rgba(255,0,153,.35)");
      sparkBurst(W*0.55, H*0.42, "rgba(0,255,255,.65)");
      sparkBurst(W*0.52, H*0.48, "rgba(255,0,153,.75)");
      sparkBurst(W*0.50, H*0.55, "rgba(255,255,255,.70)");

      overlay.classList.add("show");
      victoryText.innerHTML =
        "DAYANARA cleared the dungeon.<br>" +
        "The arcade lights flicker… then settle.<br>" +
        "<br><span style='color:rgba(0,255,255,.85)'>Reward unlocked:</span> The file link is now safe to open.";
    }

    function playerAttack(){
      if(locked) return;
      startGame();

      const crit = (charge >= 3);
      const base = rand(14, 20);
      let dmg = Math.floor(base + (crit ? rand(12, 18) : 0));
      charge = crit ? 0 : charge;

      enemyHP = clamp(enemyHP - dmg, 0, enemyMax);

      // effects: lightning + sparks + shake
      setStatus("ATTACK!");
      log("Good Choice.", "good");
      log(`You strike for ${dmg} DMG.`, "good");

      lightningFlash("rgba(255,0,0,.40)");
      sparkBurst(W*0.72, H*0.30, "rgba(255,0,153,.75)");
      sparkBurst(W*0.68, H*0.34, "rgba(0,255,255,.55)");

      enemyEnt.animate(
        [{ transform:"translateX(0)" }, { transform:"translateX(8px)" }, { transform:"translateX(0)" }],
        { duration: 180 }
      );
      enemyEnt2.animate(
        [{ transform:"translateX(0)" }, { transform:"translateX(6px)" }, { transform:"translateX(0)" }],
        { duration: 180 }
      );

      maybePhaseSwap();
      setBars();

      if(enemyHP <= 0){
        victory();
        return;
      }

      // enemy retaliation (slight delay)
      setTimeout(()=>{
        if(locked) return;
        enemyAttack();
        setStatus("YOUR TURN");
      }, 420);
    }

    function playerHeal(){
      if(locked) return;
      startGame();

      const heal = Math.floor(rand(14, 22));
      heroHP = clamp(heroHP + heal, 0, heroMax);
      setBars();

      sparkBurst(W*0.30, H*0.62, "rgba(0,255,255,.55)");
      log(`You heal +${heal} HP.`, "good");
      setStatus("HEAL");

      setTimeout(()=>{
        if(locked) return;
        enemyAttack();
        setStatus("YOUR TURN");
      }, 420);
    }

    function playerCharge(){
      if(locked) return;
      startGame();

      charge = clamp(charge + 1, 0, 3);
      log(`Charge up… (${charge}/3)`, "");
      setStatus(charge >= 3 ? "CRITICAL READY" : "CHARGING");
      sparkBurst(W*0.45, H*0.55, "rgba(255,255,255,.55)");

      setTimeout(()=>{
        if(locked) return;
        enemyAttack();
        setStatus("YOUR TURN");
      }, 420);
    }

    function resetGame(){
      locked = false;
      started = false;
      bossPhase = 0;
      charge = 0;
      heroHP = heroMax;
      enemyHP = enemyMax;
      setBars();
      setStatus("INSERT COIN → TAP TO START");
      logEl.innerHTML = "";
      log("New run loaded. Tap any action to start.", "");
    }

    // ====== Click / Touch handlers (avoid “frozen” overlays) ======
    attackBtn.addEventListener("click", (e)=>{ e.preventDefault(); playerAttack(); });
    healBtn.addEventListener("click", (e)=>{ e.preventDefault(); playerHeal(); });
    chargeBtn.addEventListener("click", (e)=>{ e.preventDefault(); playerCharge(); });
    resetBtn.addEventListener("click", (e)=>{ e.preventDefault(); resetGame(); });

    // Tap arena also starts + small sparks
    const arena = document.getElementById("arena");
    arena.addEventListener("pointerdown", (e)=>{
      startGame();
      sparkBurst(e.clientX, e.clientY, "rgba(255,255,255,.55)");
    }, {passive:true});

    closeOverlay.addEventListener("click", ()=>{
      overlay.classList.remove("show");
    });
    overlay.querySelector(".backdrop").addEventListener("click", ()=>{
      overlay.classList.remove("show");
    });

    // Initial
    setBars();
    log("Welcome to Hawkins Arcade. Defeat the guardians to unlock the file.", "");
  </script>
</body>
</html>
