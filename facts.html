<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>FACTS — Arcade Unlock</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink: rgba(255,0,153,.75);
      --cyan: rgba(0,255,255,.40);
      --red: rgba(255,0,0,.55);
      --glass: rgba(0,0,0,.55);
      --txt: rgba(255,255,255,.92);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:#000;
      color:#fff;
      font-family: system-ui, -apple-system, Arial;
      overflow:hidden;
    }

    /* ===== BACKGROUND (tu lo cambias luego si quieres) ===== */
    .bg{
      position:fixed; inset:0;
      background:
        radial-gradient(circle at 25% 20%, rgba(255,0,153,.18), rgba(0,0,0,.88)),
        radial-gradient(circle at 75% 70%, rgba(0,255,255,.10), rgba(0,0,0,.92));
      z-index:0;
    }
    .scan{
      position:fixed; inset:-40%;
      background: linear-gradient(120deg, rgba(255,0,153,0), rgba(255,0,153,.10), rgba(0,255,255,.10), rgba(255,0,153,0));
      filter: blur(18px);
      opacity:.55;
      animation: scan 7s linear infinite;
      pointer-events:none;
      z-index:1;
    }
    @keyframes scan{
      0%{ transform: translateX(-18%) translateY(-8%) rotate(6deg); }
      100%{ transform: translateX(18%) translateY(8%) rotate(6deg); }
    }
    .vignette{
      position:fixed; inset:0;
      background: radial-gradient(ellipse at 50% 30%, rgba(0,0,0,.02), rgba(0,0,0,.78));
      pointer-events:none;
      z-index:2;
    }

    canvas#fx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:3;
      opacity:.95;
    }

    /* ===== TOP BAR ===== */
    .top{
      position:fixed;
      left:14px; right:14px; top:14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      z-index:50;
      flex-wrap:wrap;
    }
    .chip{
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      border-radius:14px;
      padding:12px 14px;
      font-family: 'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      color: var(--txt);
      box-shadow: 0 0 18px rgba(255,0,153,.10);
    }
    a.back{
      text-decoration:none;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      box-shadow:none;
    }
    .title{
      flex:1;
      text-align:center;
      border-color: rgba(0,255,255,.20);
      box-shadow: 0 0 18px rgba(0,255,255,.08);
    }
    button.btn{
      cursor:pointer;
      user-select:none;
    }
    button.btn:active{ transform: translateY(1px); }

    /* ===== GAME PANEL ===== */
    .stage{
      position:fixed; inset:0;
      display:grid;
      place-items:center;
      padding:78px 14px 110px;
      z-index:40;
    }

    .panel{
      width:min(980px, 96vw);
      height:min(74vh, 680px);
      border-radius:22px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      box-shadow:
        0 0 0 2px rgba(255,0,153,.08),
        0 0 30px rgba(255,0,153,.12),
        0 0 26px rgba(0,255,255,.10);
      overflow:hidden;
      position:relative;
      display:grid;
      grid-template-columns: 1fr 320px;
    }

    .gameWrap{
      position:relative;
      background: rgba(0,0,0,.35);
      border-right: 1px solid rgba(255,255,255,.08);
      min-height: 320px;
    }

    canvas#game{
      width:100%;
      height:100%;
      display:block;
      touch-action:none;
      image-rendering: pixelated;
    }

    .side{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .logo{
      font-family:'Press Start 2P', monospace;
      font-size:14px;
      line-height:1.4;
      letter-spacing:.06em;
      text-transform: uppercase;
      margin:0;
      color: rgba(255,255,255,.92);
      text-shadow: 0 0 18px rgba(255,0,153,.18);
    }

    .desc{
      font-family: system-ui, -apple-system, Arial;
      font-size:14px;
      line-height:1.35;
      color: rgba(255,255,255,.82);
      margin:0;
    }

    .quote{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      line-height:1.7;
      color: rgba(255,255,255,.88);
      letter-spacing:.04em;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
    }

    .statRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .stat{
      flex:1;
      min-width: 120px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,0,153,.35);
      background: rgba(0,0,0,.25);
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      color: rgba(255,255,255,.88);
    }

    .bigBtn{
      padding:12px 14px;
      border-radius:14px;
      border:2px solid rgba(255,0,153,.70);
      background: rgba(0,0,0,.40);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      cursor:pointer;
      box-shadow: 0 0 18px rgba(255,0,153,.12);
    }

    .hint{
      font-family:'Press Start 2P', monospace;
      font-size:9px;
      opacity:.70;
      line-height:1.7;
      letter-spacing:.04em;
    }

    /* ===== MOBILE CONTROLS ===== */
    .controls{
      position:fixed;
      left:14px; right:14px; bottom:14px;
      z-index:60;
      display:flex;
      gap:10px;
      align-items:flex-end;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .dpad{
      display:grid;
      grid-template-columns: 56px 56px 56px;
      grid-template-rows: 56px 56px 56px;
      gap:10px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .dpad button{
      width:56px; height:56px;
      border-radius:16px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.45);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:14px;
      cursor:pointer;
      user-select:none;
    }
    .dpad button:active{ transform: scale(.98); }
    .dpad .spacer{ visibility:hidden; }

    .actionBar{
      flex:1;
      min-width: 220px;
      padding:12px 14px;
      border-radius:18px;
      border:1px solid rgba(255,0,153,.35);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .actionBar .mini{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(0,255,255,.25);
      background: rgba(0,0,0,.35);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      cursor:pointer;
    }

    /* ===== UNLOCK MODAL ===== */
    .modal{
      position:fixed; inset:0;
      display:none;
      z-index:200;
    }
    .modal.show{ display:block; }
    .modal .backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
    }
    .modal .box{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%);
      width:min(96vw, 980px);
      height:min(88vh, 740px);
      border-radius:20px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.60);
      box-shadow: 0 0 40px rgba(255,0,153,.14);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .modal .bar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
    }
    .modal .bar .t{
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      color: rgba(255,255,255,.92);
    }
    .modal .bar button{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,0,153,.55);
      background: rgba(0,0,0,.45);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      cursor:pointer;
    }
    .modal iframe{
      width:100%;
      height:100%;
      border:0;
      background:#000;
    }

    /* Responsive: en phone la side baja */
    @media (max-width: 860px){
      .panel{ grid-template-columns: 1fr; }
      .gameWrap{ border-right:0; border-bottom: 1px solid rgba(255,255,255,.08); }
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <div class="scan"></div>
  <div class="vignette"></div>
  <canvas id="fx"></canvas>

  <!-- TOP -->
  <div class="top">
    <a class="chip back" href="index.html?v=1000">← VOLVER</a>
    <div class="chip title">FACTS / ARCADE UNLOCK</div>
    <button class="chip btn" id="musicBtn" type="button">MUSIC: OFF</button>
  </div>

  <!-- STAGE -->
  <div class="stage">
    <div class="panel">
      <div class="gameWrap">
        <canvas id="game"></canvas>
      </div>

      <aside class="side">
        <h2 class="logo">DAYANARA<br>ARCADE RUN</h2>
        <p class="desc">Desbloquea el “archivo” ganando el mini-juego. Recolecta <b>10</b> orbes y evita al cazador.</p>
        <div class="quote">“When the noise gets too loud, this is what brings her back.”</div>

        <div class="statRow">
          <div class="stat">ORBS: <span id="orbsUI">0</span>/10</div>
          <div class="stat">LIVES: <span id="livesUI">3</span></div>
        </div>

        <button class="bigBtn" id="startBtn" type="button">START / INSERT COIN</button>
        <div class="hint">
          PC: flechas o WASD. <br>
          Móvil: usa el D-PAD. <br><br>
          Tip: si ganas, aparece “ACCESS GRANTED”.
        </div>
      </aside>
    </div>
  </div>

  <!-- MOBILE CONTROLS -->
  <div class="controls">
    <div class="dpad" aria-label="Dpad">
      <div class="spacer"></div>
      <button data-dir="up" type="button">▲</button>
      <div class="spacer"></div>

      <button data-dir="left" type="button">◀</button>
      <button data-dir="down" type="button">▼</button>
      <button data-dir="right" type="button">▶</button>
    </div>

    <div class="actionBar">
      <button class="mini" id="resetBtn" type="button">RESET</button>
      <div class="hint" style="margin:0; opacity:.8;">Gana para desbloquear el video.</div>
      <button class="mini" id="helpBtn" type="button">HINT</button>
    </div>
  </div>

  <!-- OPTIONAL: música arcade (pon tu mp3 si quieres) -->
  <audio id="bgm" loop preload="auto">
    <!-- si no quieres música aquí, deja vacío -->
    <!-- <source src="arcade.mp3" type="audio/mpeg"> -->
  </audio>

  <!-- UNLOCK MODAL (Drive) -->
  <div class="modal" id="modal">
    <div class="backdrop" id="modalBack"></div>
    <div class="box">
      <div class="bar">
        <div class="t" id="modalTitle">ACCESS GRANTED</div>
        <button id="closeModal" type="button">CERRAR</button>
      </div>
      <iframe id="driveFrame" src=""></iframe>
    </div>
  </div>

  <script>
    // ==========================
    // 1) Pega aquí tu link Drive
    // ==========================
    const DRIVE_VIEW_URL = "https://drive.google.com/file/d/1PNAnsFPvncZiq-sJuf-fGuq8tRrIi2w6/view?usp=drivesdk";

    function toDrivePreview(url){
      // soporta: /file/d/ID/view  o  ?id=ID
      let id = "";
      const m1 = url.match(/\/file\/d\/([^\/]+)/);
      if(m1) id = m1[1];
      const m2 = url.match(/[?&]id=([^&]+)/);
      if(!id && m2) id = m2[1];
      if(!id) return url; // fallback
      return `https://drive.google.com/file/d/${id}/preview`;
    }

    // ==========================
    // FX: simple neon dust
    // ==========================
    const fx = document.getElementById("fx");
    const fctx = fx.getContext("2d");
    let FW=0,FH=0, dpr=1;
    function fxResize(){
      dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      FW = innerWidth; FH = innerHeight;
      fx.width = Math.floor(FW*dpr);
      fx.height = Math.floor(FH*dpr);
      fx.style.width = FW+"px";
      fx.style.height = FH+"px";
      fctx.setTransform(dpr,0,0,dpr,0,0);
    }
    addEventListener("resize", fxResize);
    fxResize();
    const dust = Array.from({length:120}, ()=>({
      x: Math.random()*FW,
      y: Math.random()*FH,
      r: 0.7 + Math.random()*2.0,
      vx: -0.12 + Math.random()*0.24,
      vy: -0.18 + Math.random()*0.18,
      a: 0.06 + Math.random()*0.18
    }));
    function fxTick(){
      fctx.clearRect(0,0,FW,FH);
      for(const p of dust){
        p.x += p.vx; p.y += p.vy;
        if(p.x < -10) p.x = FW+10;
        if(p.x > FW+10) p.x = -10;
        if(p.y < -10) p.y = FH+10;
        if(p.y > FH+10) p.y = -10;

        fctx.beginPath();
        const hot = Math.random() < 0.03;
        fctx.fillStyle = hot ? `rgba(0,255,255,${p.a})` : `rgba(255,255,255,${p.a})`;
        fctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        fctx.fill();

        if(Math.random() < 0.01){
          fctx.beginPath();
          fctx.fillStyle = `rgba(255,0,153,${0.08+Math.random()*0.16})`;
          fctx.arc(p.x+(-3+Math.random()*6), p.y+(-3+Math.random()*6), p.r+1.5, 0, Math.PI*2);
          fctx.fill();
        }
      }
      requestAnimationFrame(fxTick);
    }
    fxTick();

    // ==========================
    // GAME
    // ==========================
    const game = document.getElementById("game");
    const ctx = game.getContext("2d");
    let GW=0, GH=0;

    function gameResize(){
      const rect = game.getBoundingClientRect();
      GW = Math.max(280, Math.floor(rect.width));
      GH = Math.max(280, Math.floor(rect.height));
      game.width = GW;
      game.height = GH;
    }
    addEventListener("resize", gameResize);
    gameResize();

    const orbsUI = document.getElementById("orbsUI");
    const livesUI = document.getElementById("livesUI");

    let running = false;
    let unlocked = false;

    const state = {
      x: 70, y: 70, r: 10,
      vx: 0, vy: 0,
      speed: 2.4,
      lives: 3,
      orbs: 0,
      target: 10
    };

    const hunter = {
      x: 220, y: 160, r: 12,
      speed: 1.55,
      blink: 0
    };

    const orbs = [];

    function rand(a,b){ return a + Math.random()*(b-a); }

    function seedOrbs(){
      orbs.length = 0;
      for(let i=0;i<state.target;i++){
        orbs.push({ x: rand(30,GW-30), y: rand(30,GH-30), r: 6, taken:false });
      }
    }

    function resetGame(){
      unlocked = false;
      running = false;
      state.x = 70; state.y = 70;
      hunter.x = GW-80; hunter.y = GH/2;
      state.lives = 3;
      state.orbs = 0;
      livesUI.textContent = state.lives;
      orbsUI.textContent = state.orbs;
      seedOrbs();
      draw(true);
    }

    function clamp(){
      state.x = Math.max(state.r, Math.min(GW-state.r, state.x));
      state.y = Math.max(state.r, Math.min(GH-state.r, state.y));
      hunter.x = Math.max(hunter.r, Math.min(GW-hunter.r, hunter.x));
      hunter.y = Math.max(hunter.r, Math.min(GH-hunter.r, hunter.y));
    }

    function dist(ax,ay,bx,by){
      const dx=ax-bx, dy=ay-by;
      return Math.hypot(dx,dy);
    }

    function hitFlash(){
      hunter.blink = 10;
    }

    function unlock(){
      unlocked = true;
      running = false;
      openDrive();
    }

    function draw(boot=false){
      ctx.clearRect(0,0,GW,GH);

      // grid
      ctx.globalAlpha = 0.9;
      ctx.strokeStyle = "rgba(255,0,153,.12)";
      for(let x=0;x<GW;x+=28){
        ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,GH); ctx.stroke();
      }
      for(let y=0;y<GH;y+=28){
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(GW,y); ctx.stroke();
      }

      // arena border
      ctx.strokeStyle = "rgba(0,255,255,.18)";
      ctx.lineWidth = 2;
      ctx.strokeRect(10,10,GW-20,GH-20);

      // orbs
      for(const o of orbs){
        if(o.taken) continue;
        ctx.beginPath();
        ctx.fillStyle = "rgba(0,255,255,.55)";
        ctx.shadowColor = "rgba(0,255,255,.35)";
        ctx.shadowBlur = 12;
        ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      // player (Dayanara pixel-ish)
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,255,255,.92)";
      ctx.shadowColor = "rgba(255,0,153,.35)";
      ctx.shadowBlur = 18;
      ctx.arc(state.x,state.y,state.r,0,Math.PI*2);
      ctx.fill();
      ctx.shadowBlur = 0;

      // hunter (Vecna-ish)
      ctx.beginPath();
      const c = hunter.blink>0 ? "rgba(255,0,0,.85)" : "rgba(255,0,153,.65)";
      ctx.fillStyle = c;
      ctx.shadowColor = "rgba(255,0,0,.35)";
      ctx.shadowBlur = 18;
      ctx.arc(hunter.x,hunter.y,hunter.r,0,Math.PI*2);
      ctx.fill();
      ctx.shadowBlur = 0;

      // text overlay in arena
      ctx.fillStyle = "rgba(255,255,255,.70)";
      ctx.font = "10px 'Press Start 2P'";
      ctx.fillText("COLLECT 10 ORBS → UNLOCK", 18, 28);

      if(boot && !running){
        ctx.fillStyle = "rgba(0,0,0,.55)";
        ctx.fillRect(0,0,GW,GH);
        ctx.fillStyle = "rgba(255,255,255,.90)";
        ctx.font = "12px 'Press Start 2P'";
        ctx.fillText("PRESS START", Math.max(18, GW/2 - 110), GH/2 - 8);
        ctx.font = "9px 'Press Start 2P'";
        ctx.fillText("ARROWS / WASD  •  D-PAD MOBILE", Math.max(18, GW/2 - 170), GH/2 + 18);
      }
    }

    function step(){
      if(!running) return;

      // move player
      state.x += state.vx * state.speed;
      state.y += state.vy * state.speed;

      // move hunter toward player
      const dx = state.x - hunter.x;
      const dy = state.y - hunter.y;
      const len = Math.hypot(dx,dy) || 1;
      hunter.x += (dx/len) * hunter.speed;
      hunter.y += (dy/len) * hunter.speed;

      clamp();

      // take orbs
      for(const o of orbs){
        if(o.taken) continue;
        if(dist(state.x,state.y,o.x,o.y) < state.r + o.r + 2){
          o.taken = true;
          state.orbs++;
          orbsUI.textContent = state.orbs;
          sparkAt(o.x,o.y);
          if(state.orbs >= state.target){
            unlock();
            draw();
            return;
          }
        }
      }

      // hunter hit
      if(dist(state.x,state.y,hunter.x,hunter.y) < state.r + hunter.r){
        hitFlash();
        state.lives--;
        livesUI.textContent = state.lives;

        // knockback + reposition
        state.x = 60; state.y = 60;
        hunter.x = GW-80; hunter.y = GH/2;

        if(state.lives <= 0){
          running = false;
          // reset after a beat
          setTimeout(()=>resetGame(), 650);
          draw(true);
          return;
        }
      }

      if(hunter.blink>0) hunter.blink--;

      draw();
      requestAnimationFrame(step);
    }

    // spark in arena (tiny)
    function sparkAt(x,y){
      ctx.save();
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,0,153,.85)";
      ctx.shadowColor = "rgba(0,255,255,.25)";
      ctx.shadowBlur = 20;
      ctx.arc(x,y,10,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }

    // input
    const keys = new Set();
    function applyKeys(){
      const up = keys.has("ArrowUp") || keys.has("w");
      const down = keys.has("ArrowDown") || keys.has("s");
      const left = keys.has("ArrowLeft") || keys.has("a");
      const right = keys.has("ArrowRight") || keys.has("d");
      state.vx = (right?1:0) - (left?1:0);
      state.vy = (down?1:0) - (up?1:0);
      if(state.vx && state.vy){
        const n = Math.hypot(state.vx,state.vy);
        state.vx/=n; state.vy/=n;
      }
    }
    addEventListener("keydown",(e)=>{
      const k = e.key.toLowerCase();
      if(["arrowup","arrowdown","arrowleft","arrowright","w","a","s","d"].includes(k)){
        keys.add(k.replace("arrow","Arrow"));
        keys.add(k);
        applyKeys();
        e.preventDefault();
      }
    }, {passive:false});
    addEventListener("keyup",(e)=>{
      const k = e.key.toLowerCase();
      keys.delete(k.replace("arrow","Arrow"));
      keys.delete(k);
      applyKeys();
    });

    // dpad for touch
    document.querySelectorAll(".dpad button[data-dir]").forEach(btn=>{
      const dir = btn.dataset.dir;
      const down = ()=>{
        if(dir==="up"){ keys.add("ArrowUp"); keys.add("w"); }
        if(dir==="down"){ keys.add("ArrowDown"); keys.add("s"); }
        if(dir==="left"){ keys.add("ArrowLeft"); keys.add("a"); }
        if(dir==="right"){ keys.add("ArrowRight"); keys.add("d"); }
        applyKeys();
      };
      const up = ()=>{
        if(dir==="up"){ keys.delete("ArrowUp"); keys.delete("w"); }
        if(dir==="down"){ keys.delete("ArrowDown"); keys.delete("s"); }
        if(dir==="left"){ keys.delete("ArrowLeft"); keys.delete("a"); }
        if(dir==="right"){ keys.delete("ArrowRight"); keys.delete("d"); }
        applyKeys();
      };

      btn.addEventListener("pointerdown", (e)=>{ down(); e.preventDefault(); }, {passive:false});
      btn.addEventListener("pointerup", up, {passive:true});
      btn.addEventListener("pointercancel", up, {passive:true});
      btn.addEventListener("touchstart", (e)=>{ down(); e.preventDefault(); }, {passive:false});
      btn.addEventListener("touchend", up, {passive:true});
    });

    // start/reset/help
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const helpBtn = document.getElementById("helpBtn");

    startBtn.addEventListener("click", ()=>{
      if(unlocked) return;
      if(!running){
        running = true;
        draw();
        requestAnimationFrame(step);
      }
      startArcadeMusicIfAny();
    });

    resetBtn.addEventListener("click", ()=>{
      resetGame();
    });

    helpBtn.addEventListener("click", ()=>{
      alert("Objetivo: junta 10 orbes. Evita al cazador. Si ganas, se desbloquea el video.");
    });

    // ==========================
    // MUSIC TOGGLE (si pones un mp3 en <audio id="bgm">)
    // ==========================
    const bgm = document.getElementById("bgm");
    const musicBtn = document.getElementById("musicBtn");
    let musicOn = false;
    let musicArmed = false;

    function updateMusicBtn(){
      musicBtn.textContent = musicOn ? "MUSIC: ON" : "MUSIC: OFF";
    }

    function startArcadeMusicIfAny(){
      if(!bgm || !bgm.querySelector("source") || !bgm.querySelector("source").getAttribute("src")) return;
      if(!musicArmed){
        bgm.volume = 0.55;
        musicArmed = true;
      }
      bgm.play().catch(()=>{});
      musicOn = true;
      updateMusicBtn();
    }

    function stopArcadeMusic(){
      if(!bgm) return;
      bgm.pause();
      musicOn = false;
      updateMusicBtn();
    }

    musicBtn.addEventListener("click", ()=>{
      if(!musicOn) startArcadeMusicIfAny();
      else stopArcadeMusic();
    });
    updateMusicBtn();

    // ==========================
    // UNLOCK MODAL (Drive)
    // ==========================
    const modal = document.getElementById("modal");
    const driveFrame = document.getElementById("driveFrame");
    const modalBack = document.getElementById("modalBack");
    const closeModal = document.getElementById("closeModal");

    function openDrive(){
      const preview = toDrivePreview(DRIVE_VIEW_URL);
      driveFrame.src = preview;
      modal.classList.add("show");
    }
    function closeDrive(){
      modal.classList.remove("show");
      driveFrame.src = "";
    }
    closeModal.addEventListener("click", closeDrive);
    modalBack.addEventListener("click", closeDrive);

    // init
    resetGame();
  </script>
</body>
</html>
