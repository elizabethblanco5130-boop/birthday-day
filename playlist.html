<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Anti-Vecna Mixtape</title>

  <link href="https://fonts.cdnfonts.com/css/benguiat" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --red: rgba(255,0,0,.75);
      --glass: rgba(0,0,0,.45);
    }
    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      background:#000;
      color:#fff;
      overflow:hidden;
      font-family: system-ui, -apple-system, Arial;
    }

    /* ===== BACKGROUND IMAGE ===== */
    .bg{ position:fixed; inset:0; background:#000; z-index:0; }
    .bg img{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:cover;
      filter: saturate(0.95) contrast(1.05);
      transform: scale(1.01);
      cursor:pointer;
      user-select:none;
      -webkit-user-drag:none;
    }

    .vignette{
      position:fixed; inset:0;
      background:
        radial-gradient(ellipse at 40% 35%, rgba(0,0,0,.02), rgba(0,0,0,.70)),
        radial-gradient(ellipse at 70% 30%, rgba(0,0,0,.10), rgba(0,0,0,.85));
      pointer-events:none;
      z-index:2;
    }

    .shieldTint{
      position:fixed; inset:0;
      background: radial-gradient(circle at 22% 72%, rgba(255,0,0,.10), rgba(0,0,0,0));
      opacity:.15;
      pointer-events:none;
      z-index:3;
      transition: opacity .6s ease, filter .6s ease;
      filter:none;
    }

    /* ===== IDLE DARK/RED ===== */
    .idleDark{
      position:fixed; inset:0;
      opacity:0;
      pointer-events:none;
      z-index:20;
      transition: opacity .8s ease;
    }
    body.idle .idleDark{ opacity:.45; }

    .idleRed{
      position:fixed; inset:0;
      opacity:0;
      pointer-events:none;
      z-index:21;
      transition: opacity .6s ease;
      background:
        radial-gradient(circle at 50% 45%, rgba(255,0,0,.32), rgba(0,0,0,0) 55%),
        linear-gradient(180deg, rgba(120,0,0,.25), rgba(0,0,0,.35));
      mix-blend-mode: screen;
    }
    body.idle .idleRed{ opacity:1; }

    /* ===== LIGHTNING (rojo) ===== */
    .stormLayer{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:22;
      opacity:0;
      transition: opacity .25s ease;
    }
    body.idle .stormLayer{ opacity:1; }

    .stormFlash{
      position:absolute; inset:-20%;
      opacity:0;
      mix-blend-mode: screen;
      filter: blur(1px);
      animation: lightning 4.8s infinite;
      background:
        radial-gradient(circle at 70% 30%, rgba(255,0,0,.18), rgba(0,0,0,0) 42%),
        radial-gradient(circle at 25% 55%, rgba(255,80,80,.12), rgba(0,0,0,0) 45%);
    }
    @keyframes lightning{
      0%, 70%, 100% { opacity:0; transform: translate(0,0); }
      72% { opacity:.14; transform: translate(-8px, 4px); }
      73% { opacity:0; }
      76% { opacity:.22; transform: translate(10px, -6px); }
      77% { opacity:0; }
      79% { opacity:.12; transform: translate(-6px, 2px); }
      80% { opacity:0; }
    }

    /* vibración de UI en idle */
    body.idle .ui{ animation: shake .22s infinite; }
    @keyframes shake{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(1px,-1px); }
      50%{ transform: translate(-1px,1px); }
      75%{ transform: translate(1px,1px); }
      100%{ transform: translate(0,0); }
    }

    canvas#fx{
      position:fixed; inset:0;
      z-index:4;
      pointer-events:none;
      opacity:.9;
    }

    .whisper{
      position:fixed;
      top:14px; left:50%;
      transform: translateX(-50%);
      max-width:min(92vw, 740px);
      padding:10px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      color: rgba(255,255,255,.85);
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      letter-spacing: .06em;
      opacity:0;
      z-index:60;
      transition: opacity .35s ease, transform .35s ease;
      pointer-events:none;
      text-align:center;
    }
    .whisper.show{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }

    /* ===== UI ===== */
    .ui{
      position:fixed;
      left:16px;
      bottom:16px;
      width:min(420px, calc(100vw - 32px));
      z-index:50;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .panel{
      border-radius:20px;
      border:1px solid rgba(255,0,0,.55);
      background: rgba(0,0,0,.45);
      box-shadow: 0 0 32px rgba(255,0,0,.12);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .header{
      padding:14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .logo{
      margin:0;
      font-family: 'Benguiat', serif;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-size: 34px;
      line-height: .95;
      color: rgba(255,255,255,.92);
      text-shadow:
        0 0 18px rgba(255,0,0,.25),
        2px 0 rgba(0,255,255,.18),
        -2px 0 rgba(255,0,0,.18);
      user-select:none;
      cursor:pointer;
    }

    .subtitle{
      margin:10px 0 0;
      color: rgba(255,255,255,.82);
      font-size: 14px;
      line-height: 1.35;
    }
    .quote{
      margin:10px 0 0;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: rgba(255,255,255,.88);
      letter-spacing: .04em;
      line-height: 1.6;
    }

    .playlist{
      padding:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .track{
      position:relative;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,0,0,.55);
      background: rgba(0,0,0,.38);
      backdrop-filter: blur(8px);
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      min-height:64px;
    }
    .track .tag{
      font-family: 'Press Start 2P', monospace;
      font-size: 9px;
      opacity:.85;
      letter-spacing:.06em;
      color: rgba(255,255,255,.78);
      text-transform: uppercase;
    }
    .track .name{
      margin-top:8px;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      line-height:1.5;
      color: rgba(255,255,255,.92);
      letter-spacing:.04em;
      text-transform: uppercase;
    }

    .controls{
      padding:12px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .btn{
      flex:1;
      min-width: 140px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,0,0,.60);
      background: rgba(0,0,0,.45);
      color:#fff;
      font-family:'Press Start 2P', monospace;
      font-size:10px;
      letter-spacing:.06em;
      text-transform: uppercase;
      text-decoration:none;
      text-align:center;
      cursor:pointer;
      backdrop-filter: blur(8px);
    }
    .btn.main{
      border:2px solid rgba(255,0,0,.75);
      box-shadow: 0 0 18px rgba(255,0,0,.18);
    }

    @media (min-width: 900px){
      .ui{ left:26px; bottom:26px; width: 440px; }
      .logo{ font-size: 40px; }
    }
  </style>
</head>

<body>
  <div class="bg">
    <!-- ✅ tu imagen (con mayúsculas si así está) -->
    <img id="maxImg" src="img/max.PNG" alt="Max moment">
  </div>

  <div class="vignette"></div>
  <div class="shieldTint"></div>
  <canvas id="fx"></canvas>

  <div class="idleDark"></div>
  <div class="idleRed"></div>

  <div class="stormLayer" aria-hidden="true">
    <div class="stormFlash"></div>
  </div>

  <div class="whisper" id="whisper">Running won’t save you…</div>

  <div class="ui">
    <section class="panel">
      <div class="header">
        <h1 class="logo" id="logo">ANTI-VECNA<br> MIXTAPE</h1>
        <div class="subtitle">Estas canciones la mantienen a salvo. No son nostalgia. Son supervivencia.</div>
        <div class="quote">“When the noise gets too loud, this is what brings her back.”</div>
      </div>

      <!-- 10 placeholders -->
      <div class="playlist" id="playlist">
        <div class="track" data-index="0" data-src="" data-title="Song 01" data-artist="Artist">
          <div class="tag">Cassette 01</div>
          <div class="name">Song 01 — Artist</div>
        </div>
        <div class="track" data-index="1" data-src="" data-title="Song 02" data-artist="Artist">
          <div class="tag">Cassette 02</div>
          <div class="name">Song 02 — Artist</div>
        </div>
        <div class="track" data-index="2" data-src="" data-title="Song 03" data-artist="Artist">
          <div class="tag">Cassette 03</div>
          <div class="name">Song 03 — Artist</div>
        </div>
        <div class="track" data-index="3" data-src="" data-title="Song 04" data-artist="Artist">
          <div class="tag">Cassette 04</div>
          <div class="name">Song 04 — Artist</div>
        </div>
        <div class="track" data-index="4" data-src="" data-title="Song 05" data-artist="Artist">
          <div class="tag">Cassette 05</div>
          <div class="name">Song 05 — Artist</div>
        </div>
        <div class="track" data-index="5" data-src="" data-title="Song 06" data-artist="Artist">
          <div class="tag">Cassette 06</div>
          <div class="name">Song 06 — Artist</div>
        </div>
        <div class="track" data-index="6" data-src="" data-title="Song 07" data-artist="Artist">
          <div class="tag">Cassette 07</div>
          <div class="name">Song 07 — Artist</div>
        </div>
        <div class="track" data-index="7" data-src="" data-title="Song 08" data-artist="Artist">
          <div class="tag">Cassette 08</div>
          <div class="name">Song 08 — Artist</div>
        </div>
        <div class="track" data-index="8" data-src="" data-title="Song 09" data-artist="Artist">
          <div class="tag">Cassette 09</div>
          <div class="name">Song 09 — Artist</div>
        </div>
        <div class="track" data-index="9" data-src="" data-title="Song 10" data-artist="Artist">
          <div class="tag">Cassette 10</div>
          <div class="name">Song 10 — Artist</div>
        </div>
      </div>

      <div class="controls">
        <a class="btn" href="index.html?v=1000">← VOLVER</a>
        <button class="btn main" id="panicBtn" type="button">PRESS PLAY</button>
        <a class="btn" href="hub.html?v=1000">HUB →</a>
      </div>
    </section>
  </div>

  <!-- preview player (para después) -->
  <audio id="player" preload="auto"></audio>

  <!-- ✅ IDLE AUDIO: primero underw.mp3, 5s después vecna.wav -->
  <audio id="underw" preload="auto" loop>
    <source src="underw.mp3" type="audio/mpeg">
  </audio>
  <audio id="vecna" preload="auto" loop>
    <source src="vecna.wav" type="audio/wav">
  </audio>

  <script>
    // =========================
    // AUDIO unlock (iPhone)
    // =========================
    let audioUnlocked = false;
    function unlockAudio(){
      audioUnlocked = true;
      window.removeEventListener("pointerdown", unlockAudio);
      window.removeEventListener("touchstart", unlockAudio);
      window.removeEventListener("click", unlockAudio);
    }
    window.addEventListener("pointerdown", unlockAudio, { once:true });
    window.addEventListener("touchstart", unlockAudio, { once:true });
    window.addEventListener("click", unlockAudio, { once:true });

    // =========================
    // Whisper helper
    // =========================
    const whisper = document.getElementById("whisper");
    function showWhisper(msg){
      whisper.textContent = msg;
      whisper.classList.add("show");
      setTimeout(()=>whisper.classList.remove("show"), 1800);
    }

    // =========================
    // IDLE + 2 audios en secuencia
    // =========================
    const aUnderw = document.getElementById("underw");
    const aVecna  = document.getElementById("vecna");

    let idleTimer = null;
    let vecnaDelayTimer = null;
    let inIdle = false;

    function stopIdleAudio(){
      clearTimeout(vecnaDelayTimer);
      vecnaDelayTimer = null;

      if(aUnderw){
        try{ aUnderw.pause(); aUnderw.currentTime = 0; }catch(e){}
      }
      if(aVecna){
        try{ aVecna.pause(); aVecna.currentTime = 0; }catch(e){}
      }
    }

    function startIdleAudioSequence(){
      if(!audioUnlocked) return; // iPhone necesita un toque previo

      // Underw primero
      if(aUnderw){
        try{
          aUnderw.volume = 0.55;
          aUnderw.play().catch(()=>{});
        }catch(e){}
      }

      // 5 segundos después entra Vecna
      vecnaDelayTimer = setTimeout(()=>{
        if(!inIdle) return;
        if(aVecna){
          try{
            aVecna.volume = 0.55;
            aVecna.play().catch(()=>{});
          }catch(e){}
        }
      }, 5000);
    }

    function setIdle(on){
      inIdle = on;
      document.body.classList.toggle("idle", on);

      if(on){
        showWhisper("Running won’t save you…");
        startIdleAudioSequence();
      }else{
        stopIdleAudio();
      }
    }

    function resetIdle(){
      setIdle(false);
      clearTimeout(idleTimer);
      idleTimer = setTimeout(()=>{
        setIdle(true);
      }, 6500);
    }

    ["pointerdown","mousemove","touchstart","keydown","scroll"].forEach(ev=>{
      window.addEventListener(ev, resetIdle, {passive:true});
    });
    resetIdle();

    // =========================
    // TU PARTE DE MUSIC/PLAYLIST
    // (lo dejamos igual por ahora)
    // =========================
    const tracks = [...document.querySelectorAll(".track")];
    const player = document.getElementById("player");
    const panicBtn = document.getElementById("panicBtn");

    function playTrack(el){
      resetIdle(); // tocar música saca del idle
      // (por ahora: todavía no enciende relámpagos blancos; lo hacemos después)
      showWhisper("Good. You chose music.");

      const src = (el.dataset.src || "").trim();
      if(src){
        player.src = src;
        player.currentTime = 0;
        player.volume = 0.55;
        player.play().catch(()=>{});
      }
    }

    tracks.forEach(el=>{
      el.addEventListener("click", ()=> playTrack(el));
    });

    panicBtn.addEventListener("click", ()=>{
      resetIdle();
      const i = Math.floor(Math.random()*tracks.length);
      playTrack(tracks[i]);
    });
  </script>
</body>
</html>
